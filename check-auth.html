<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
        }
        .status {
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            background: #333;
        }
        .success { background: #4caf50; }
        .error { background: #f44336; }
        .info { background: #2196f3; }
        pre {
            background: #111;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #ff5252; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Firebase</h1>
        
        <div id="auth-status" class="status">
            –ü—Ä–æ–≤–µ—Ä–∫–∞...
        </div>
        
        <div id="user-info"></div>
        
        <div id="storage-info" class="status info" style="margin-top: 20px;">
            <h3>üì¶ –î–∞–Ω–Ω—ã–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:</h3>
            <pre id="storage-data"></pre>
        </div>
        
        <div style="margin-top: 20px;">
            <button onclick="checkAuth()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            <button onclick="forceSignIn()">üîë –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥</button>
            <button onclick="signOut()">üö™ –í—ã–π—Ç–∏</button>
            <button onclick="window.location.href='/'">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBzDxg3S9cfseoozmZSksUh1aLbkVBG--Q",
            authDomain: "song-archive-389a6.firebaseapp.com",
            projectId: "song-archive-389a6",
            storageBucket: "song-archive-389a6.appspot.com",
            messagingSenderId: "660585697058",
            appId: "1:660585697058:web:7ceacf752ce6b21ad8fb40"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkAuth() {
            const statusDiv = document.getElementById('auth-status');
            const userInfoDiv = document.getElementById('user-info');
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                    
                    userInfoDiv.innerHTML = `
                        <div class="status">
                            <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h3>
                            <p><strong>UID:</strong> ${user.uid}</p>
                            <p><strong>Email:</strong> ${user.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p><strong>Phone:</strong> ${user.phoneNumber || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p><strong>Display Name:</strong> ${user.displayName || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p><strong>Provider:</strong> ${user.providerData[0]?.providerId || 'Unknown'}</p>
                        </div>
                    `;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Firestore
                    checkFirestoreUser(user.uid);
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = '‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                    userInfoDiv.innerHTML = '';
                }
                
                checkStorage();
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore
        async function checkFirestoreUser(uid) {
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                const userInfoDiv = document.getElementById('user-info');
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    userInfoDiv.innerHTML += `
                        <div class="status info">
                            <h3>üìÑ –î–∞–Ω–Ω—ã–µ –∏–∑ Firestore:</h3>
                            <pre>${JSON.stringify(userData, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    userInfoDiv.innerHTML += `
                        <div class="status error">
                            <p>‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Firestore</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Firestore error:', error);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        function checkStorage() {
            const storageData = {
                localStorage: {},
                sessionStorage: {}
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('firebase') || key.includes('auth')) {
                    storageData.localStorage[key] = localStorage.getItem(key).substring(0, 50) + '...';
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º sessionStorage
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                if (key.includes('firebase') || key.includes('auth')) {
                    storageData.sessionStorage[key] = sessionStorage.getItem(key).substring(0, 50) + '...';
                }
            }
            
            document.getElementById('storage-data').textContent = JSON.stringify(storageData, null, 2);
        }
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∞
        async function forceSignIn() {
            const email = '19exxtazzy96@gmail.com';
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è ' + email);
            
            if (password) {
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    alert('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                    checkAuth();
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        }
        
        // –í—ã—Ö–æ–¥
        async function signOut() {
            try {
                await auth.signOut();
                alert('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                checkAuth();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            checkAuth();
        };
    </script>
</body>
</html>