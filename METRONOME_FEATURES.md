# Новый Метроном - Функциональность и Возможности

## Обзор
Полностью новый метроном с overlay интерфейсом, интегрированный в нижнюю панель навигации сайта Agape Worship.

## Основные возможности

### 1. Overlay Интерфейс
- **Кнопка "Метроном"** в нижней панели навигации открывает полноэкранный overlay
- **Закрытие**: кнопка X, клик по фону, или клавиша Escape
- **Анимированное появление/исчезновение** с плавными переходами

### 2. Управление BPM
- **Диапазон**: 40-200 BPM
- **Большое поле ввода** в центре для ручного ввода значения
- **Кнопки +/-** для точной настройки (шаг 1 BPM)
- **Горизонтальный слайдер** во всю ширину с drag-and-drop
- **Реальное время**: изменения BPM отображаются мгновенно при перетаскивании

### 3. Интеграция с Firebase
- **Автоматическая загрузка BPM** из данных песни при выборе
- **Отображение в навигации**: текущий BPM песни или "NA" если песня не выбрана
- **Синхронизация**: метроном использует BPM выбранной песни по умолчанию

### 4. Нижняя панель навигации
- **Кнопка метронома** с иконкой барабана
- **Отображение BPM** рядом с кнопкой
- **Кнопка Play/Stop** для быстрого управления без открытия overlay
- **Визуальная индикация**: активное состояние метронома отображается красным цветом

### 5. Размер (Time Signature)
- **Выпадающий список** слева от BPM в overlay
- **Поддерживаемые размеры**: 4/4, 3/4, 6/8, 2/4
- **Акцентирование**: первый удар в такте звучит громче

### 6. Управление воспроизведением
- **Большая кнопка Play/Stop** в overlay
- **Малая кнопка** в нижней панели для быстрого доступа
- **Визуальная обратная связь**: анимация пульсации при активном метрономе
- **Автоматический перезапуск** при изменении BPM во время воспроизведения

### 7. Клавиатурные сокращения (в overlay)
- **Escape**: закрыть overlay
- **Пробел**: включить/выключить метроном
- **↑**: увеличить BPM на 1
- **↓**: уменьшить BPM на 1

### 8. Адаптивный дизайн
- **Мобильные устройства**: оптимизированные размеры и отступы
- **Планшеты**: средние размеры элементов
- **Десктоп**: полноразмерный интерфейс
- **Сенсорное управление**: поддержка touch событий для слайдера

### 9. Темы
- **Темная тема**: черный overlay с синими акцентами
- **Светлая тема**: белый overlay с адаптированными цветами
- **Автоматическое переключение** в соответствии с темой сайта

### 10. Визуальные эффекты
- **Градиентный прогресс-бар** на слайдере
- **Тени и свечение** для primary элементов
- **Анимации hover** и active состояний
- **Пульсация кнопки** при активном метрономе

## Техническая реализация

### Файлы
- `metronome.js` - основная логика метронома
- `styles/metronome.css` - стили overlay и навигации
- Интеграция в `index.html`, `script.js`

### API
```javascript
// Основные функции экспорта
initMetronomeUI()           // Инициализация
updateBPMFromSong(bpm)      // Обновление BPM из песни
getCurrentBPM()             // Получение текущего BPM
stopMetronome()             // Остановка метронома
updateMetronomeButtonState(isActive) // Обновление состояния кнопок
resetBPMToOriginal()        // Сброс к оригинальному BPM песни
```

### Интеграция с существующим кодом
- Использует существующую логику `core.js` для воспроизведения звука
- Интегрируется с Firebase через `ui.js`
- Совместим с системой тем сайта
- Не конфликтует с другими модулями

## Преимущества нового решения

1. **Удобство использования**: overlay не мешает основному контенту
2. **Быстрый доступ**: управление с нижней панели без открытия overlay
3. **Визуальная привлекательность**: современный дизайн в стиле сайта
4. **Функциональность**: больше возможностей управления BPM
5. **Интеграция**: тесная связь с данными песен из Firebase
6. **Производительность**: отсутствие внешних зависимостей
7. **Адаптивность**: работает на всех устройствах

## Использование

1. **Открытие**: нажмите кнопку "Метроном" в нижней панели
2. **Настройка BPM**: используйте поле ввода, кнопки +/- или слайдер
3. **Выбор размера**: измените time signature в выпадающем списке
4. **Запуск**: нажмите большую кнопку Play в overlay или малую в панели
5. **Закрытие**: нажмите X, Escape или кликните по фону

Метроном автоматически использует BPM выбранной песни и отображает его в нижней панели навигации.