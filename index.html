<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agape Worship</title>
    <link rel="stylesheet" href="styles.css?v=5.5">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <link rel="manifest" href="manifest.json">  </head>
<body>

<div id="notes-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3 class="modal-title">–ó–∞–º–µ—Ç–∫–∞ –∫ –ø–µ—Å–Ω–µ</h3>
        <textarea id="note-edit-textarea" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏..."></textarea>
        <div class="modal-actions">
            <button id="save-note-button" class="modal-button primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button id="cancel-note-button" class="modal-button secondary">–û—Ç–º–µ–Ω–∞</button>
        </div>
        <button id="close-note-modal-x" class="modal-close-x">&times;</button>
    </div>
</div>

<header>
    <h1>Agape Worship</h1>
    <button id="theme-toggle-button" class="theme-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
      <span class="theme-toggle-bg">
        <i class="fas fa-moon theme-icon moon"></i>
        <i class="fas fa-sun theme-icon sun"></i>
      </span>
      <span class="theme-toggle-slider">
        <i class="fas fa-moon"></i>
      </span>
    </button>
</header>

<main class="container">
    <section class="controls">
        <fieldset class="search-group">
            <legend>–ü–æ–∏—Å–∫</legend>
            <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏...">
            <div id="search-results"></div>
        </fieldset>
        <div class="select-filters-container">
            <div class="filter-group">
                <select id="sheet-select">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é --</option>
                </select>
            </div>
            <div class="filter-group">
                <select id="song-select">
                    <option value="">-- –ü–µ—Å–Ω—è --</option>
                </select>
            </div>
        </div>
        <div class="control-group">
            <fieldset class="key-group">
                <legend>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</legend>
                <select id="key-select">
                    <option value="C">C</option>
                    <option value="C#">C#</option>
                    <option value="D">D</option>
                    <option value="D#">D#</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="F#">F#</option>
                    <option value="G">G</option>
                    <option value="G#">G#</option>
                    <option value="A">A</option>
                    <option value="A#">A#</option>
                    <option value="H">H</option>
                </select>
            </fieldset>
            <div class="function-buttons-group">
                <button id="toggle-chords-button" class="control-group-button icon-button simple" title="–°–∫—Ä—ã—Ç—å –∞–∫–∫–æ—Ä–¥—ã">
                    <i class="fas fa-guitar"></i>
                    <span class="button-text">–ê–∫–∫–æ—Ä–¥—ã</span>
                </button>
                <button id="chords-only-button" class="control-group-button icon-button simple" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫–∫–æ—Ä–¥—ã">
                    <span class="text-icon">T</span>
                    <span class="button-text">–¢–æ–ª—å–∫–æ –∞–∫–∫–æ—Ä–¥—ã</span>
                </button>
                <button id="split-text-button" aria-label="–†–∞–∑–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç" class="control-group-button icon-button simple">
                    <i class="fas fa-columns"></i>
                    <span class="button-text">–†–∞–∑–¥–µ–ª–∏—Ç—å</span>
                </button>
            </div>
            <div class="font-size-controls">
                <button id="zoom-out" class="icon-button simple" title="–£–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç"><i class="fas fa-search-minus"></i></button>
                <button id="zoom-in" class="icon-button simple" title="–£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç"><i class="fas fa-search-plus"></i></button>
            </div>
        </div>
    </section>

    <fieldset id="song-content">
        <legend id="song-title">
            <span class="song-title-text">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Å–Ω—é</span>
            <button id="edit-song-button" class="icon-button simple legend-button" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Å–Ω—é" style="display: none;">
                <i class="fas fa-edit"></i>
            </button>
        </legend>
        <div class="song-actions-legend-row">
            <div class="song-legend-action" data-legend="–°–µ—Ç –ª–∏—Å—Ç">
                <button id="add-to-setlist-button" class="legend-icon-btn setlist" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="song-legend-action" data-legend="–ú–æ–∏">
                <button id="favorite-button" class="legend-icon-btn heart" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –ú–æ–∏" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –ú–æ–∏">
                    <i class="far fa-heart"></i>
                </button>
            </div>
            <div class="song-legend-action" data-legend="–†–µ–ø–µ—Ä—Ç—É–∞—Ä">
                <button id="repertoire-button" class="legend-icon-btn mic" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä" title="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
        </div>
        <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
        <button id="copy-text-button" class="icon-button simple" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏" style="display: none;">
            <i class="far fa-copy"></i>
        </button>
        <pre id="song-display"></pre>
    </fieldset>

    <!-- Metronome Control Bar - Under Song -->
    <div class="metronome-control-bar">
        <button id="open-metronome-overlay" class="metronome-button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ—Ç—Ä–æ–Ω–æ–º" title="–ú–µ—Ç—Ä–æ–Ω–æ–º">
            <i class="fas fa-drum" aria-hidden="true"></i>
            <span>–ú–µ—Ç—Ä–æ–Ω–æ–º</span>
        </button>
        
        <div class="current-bpm-display">
            <span id="current-bpm-value" class="bpm-value">NA</span>
            <span class="bpm-unit">BPM</span>
        </div>
        
        <button id="metronome-play-toggle" class="metronome-play-toggle" aria-label="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–æ–Ω–æ–º" title="Play/Stop">
            <i class="fas fa-play"></i>
            <span class="play-text">Play</span>
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div id="song-editor-overlay" class="song-editor-overlay">
        <div class="song-editor-modal">
            <div class="song-editor-header">
                <h3 id="song-editor-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏</h3>
                <button id="close-editor-button" class="icon-button simple" title="–ó–∞–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="song-editor-content">
                <div class="editor-info">
                    <span id="edit-status-info">üìÑ –û—Ä–∏–≥–∏–Ω–∞–ª –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã</span>
                    <button id="revert-to-original-button" class="editor-button revert" style="display: none;">
                        <i class="fas fa-undo"></i>
                        –í–µ—Ä–Ω—É—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
                    </button>
                </div>
                
                <textarea id="song-edit-textarea" class="song-edit-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ —Å –∞–∫–∫–æ—Ä–¥–∞–º–∏..."></textarea>
            </div>
            
            <div class="song-editor-footer">
                <div class="editor-controls">
                    <button id="save-edit-button" class="editor-button save">
                        <i class="fas fa-save"></i>
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button id="cancel-edit-button" class="editor-button cancel">
                        <i class="fas fa-times"></i>
                        –û—Ç–º–µ–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>



     <section id="youtube-player-section" style="margin-top: 20px; display: none;">
         <h3>–í–∏–¥–µ–æ / –ê—É–¥–∏–æ</h3>
         <p id="youtube-video-key-display" style="text-align: center; margin-bottom: 10px; display: none; font-size: 0.9rem; color: var(--label-color);"></p>
         <div id="youtube-player-container" style="max-width: 100%; margin: auto;">
             </div>
     </section>

    <div class="controls-footer">
        <a id="holychords-button" href="#" target="_blank">Holychords</a>
    </div>
</main>

<aside id="setlists-panel" class="side-panel setlists-panel">
    <button class="side-panel-close-btn icon-button simple" title="–ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å">
        <i class="fas fa-chevron-left"></i>
    </button>
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ -->
    <div class="panel-header-section">
        <h3 class="panel-title">–°–µ—Ç-–ª–∏—Å—Ç—ã</h3>
    </div>
    
    <!-- –ë–õ–û–ö 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞ (–ø—Ä–µ–º–∏—É–º –¥–∏–∑–∞–π–Ω) -->
    <div class="ui-section create-section">
        <button id="create-new-setlist-header-btn" class="create-btn-modern">
            <div class="btn-content">
                <i class="fas fa-plus"></i>
                <span>–°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫</span>
            </div>
            <div class="btn-shine"></div>
        </button>
    </div>
    
    <!-- –ë–õ–û–ö 2: –í—ã–±–æ—Ä —Å–ø–∏—Å–∫–∞ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω) -->
    <div class="ui-section selection-section">
        <div class="section-label">–í—ã–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫</div>
        <div class="modern-selector">
            <button id="setlist-dropdown-btn" class="selector-btn">
                <div class="selector-content">
                    <i class="fas fa-list"></i>
                    <span id="current-setlist-name" class="selector-text">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ç-–ª–∏—Å—Ç</span>
                </div>
                <i class="fas fa-chevron-down selector-arrow"></i>
            </button>
            
            <!-- Dropdown –º–µ–Ω—é -->
            <div id="setlist-dropdown-menu" class="modern-dropdown">
                <div id="setlists-list-container" class="dropdown-content">
                    <div class="empty-message">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ç-–ª–∏—Å—Ç–æ–≤...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–õ–û–ö 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º (—ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω) -->
    <div id="selected-setlist-control" class="ui-section active-section" style="display: none;">
        <div class="section-header">
            <div class="list-status">
                <i class="fas fa-music"></i>
                <span id="songs-count-text" class="count-text">0 –ø–µ—Å–µ–Ω</span>
            </div>
        </div>
        <div class="action-buttons">
            <button id="add-song-btn" class="action-btn primary-action">
                <i class="fas fa-plus"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å</span>
            </button>
            <button id="start-presentation-button" class="action-btn secondary-action">
                <i class="fas fa-play"></i>
                <span>–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</span>
            </button>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ç-–ª–∏—Å—Ç–∞ -->
    <div id="current-setlist-songs-container" class="songs-list">
        <div class="empty-message">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ç-–ª–∏—Å—Ç</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤–Ω–∏–∑—É (—É–¥–∞–ª–µ–Ω—ã, –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –Ω–∞–≤–µ—Ä—Ö) -->


</aside>

<aside id="my-list-panel" class="side-panel my-list-panel">
    <button class="side-panel-close-btn icon-button simple" title="–ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å"><i class="fas fa-chevron-left"></i></button>
    <div id="my-list" class="list-section">
        <h3>–ú–æ–∏</h3>
        <div id="favorites-list" class="list-container">
            <div class="empty-message">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>
</aside>

<aside id="repertoire-panel" class="side-panel repertoire-panel">
    <button class="side-panel-close-btn icon-button simple" title="–ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å"><i class="fas fa-chevron-right"></i></button>
    <h3 class="panel-header">–†–µ–ø–µ—Ä—Ç—É–∞—Ä</h3>

    <div class="repertoire-vocalist-selector">
        <label for="vocalist-select">–í–æ–∫–∞–ª–∏—Å—Ç:</label>
        <select id="vocalist-select">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∫–∞–ª–∏—Å—Ç–∞ --</option>
            </select>
    </div>

    <div class="repertoire-view-controls">
        <button id="repertoire-view-key" class="repertoire-view-button active" title="–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏">
            <i class="fas fa-key"></i> <span class="button-text-rp">–ü–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</span>
        </button>
        <button id="repertoire-view-sheet" class="repertoire-view-button" title="–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ª–∏—Å—Ç–∞–º">
            <i class="far fa-file-alt"></i> <span class="button-text-rp">–ü–æ –ª–∏—Å—Ç–∞–º</span>
        </button>
        <button id="repertoire-view-all" class="repertoire-view-button" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ">
            <i class="fas fa-sort-alpha-down"></i> <span class="button-text-rp">–í–µ—Å—å —Å–ø–∏—Å–æ–∫</span>
        </button>
    </div>
    <div id="repertoire-panel-list" class="repertoire-list-container list-container">
        <div class="empty-message">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∫–∞–ª–∏—Å—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä–∞.</div>
        </div>
</aside>

<div id="presentation-overlay" class="presentation-overlay">
    <button id="presentation-close-btn" class="presentation-close-btn" title="–ó–∞–∫—Ä—ã—Ç—å —Ä–µ–∂–∏–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏">&times;</button>
    <button id="pres-split-text-btn" class="presentation-control-btn" title="–†–∞–∑–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç">
        <i class="fas fa-columns"></i>
    </button>
    <div class="presentation-controls">
        <button id="pres-prev-btn" class="presentation-nav-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–µ—Å–Ω—è">
            <i class="fas fa-chevron-left"></i>
        </button>
        <span id="pres-counter" class="presentation-counter">0 / 0</span>
        <button id="pres-next-btn" class="presentation-nav-btn" title="–°–ª–µ–¥—É—é—â–∞—è –ø–µ—Å–Ω—è">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
    <div id="presentation-content" class="presentation-content">
        </div>
</div>

<!-- Metronome Overlay -->
<div id="metronome-overlay" class="metronome-overlay">
    <div class="metronome-modal">
        <div class="metronome-header">
            <div class="metronome-time-signature">
                <select id="metronome-time-signature" class="time-signature-select">
                    <option value="4">4/4</option>
                    <option value="3">3/4</option>
                    <option value="6">6/8</option>
                    <option value="2">2/4</option>
                </select>
            </div>
            
            <div class="metronome-bpm-display">
                <input type="number" id="metronome-bpm-input" class="bpm-input-large" min="40" max="200" step="1" value="120">
                <span class="bpm-label">BPM</span>
            </div>
            
            <button id="close-metronome-overlay" class="close-metronome-btn" title="–ó–∞–∫—Ä—ã—Ç—å –º–µ—Ç—Ä–æ–Ω–æ–º">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="metronome-main-controls">
            <div class="bmp-controls-row">
                <button class="bpm-control-btn bpm-decrease" id="metronome-bpm-decrease" title="–£–º–µ–Ω—å—à–∏—Ç—å BPM">
                    <i class="fas fa-minus"></i>
                </button>
                
                <div class="bpm-slider-container">
                    <div class="bpm-slider-track">
                        <div class="bpm-slider-progress" id="bpm-slider-progress"></div>
                        <div class="bpm-slider-handle" id="bpm-slider-handle">
                            <div class="handle-indicator"></div>
                        </div>
                    </div>
                    <div class="bpm-range-labels">
                        <span class="range-min">40</span>
                        <span class="range-max">200</span>
                    </div>
                </div>
                
                <button class="bpm-control-btn bpm-increase" id="metronome-bpm-increase" title="–£–≤–µ–ª–∏—á–∏—Ç—å BPM">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="metronome-play-controls">
                <button id="metronome-play-button" class="metronome-play-button-large" aria-label="–í–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–æ–Ω–æ–º">
                    <i class="fas fa-play"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<div id="loading-indicator">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<nav class="mobile-bottom-nav" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <button id="toggle-setlists" class="mobile-nav-button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Å–µ—Ç-–ª–∏—Å—Ç–æ–≤" title="–°–µ—Ç-–ª–∏—Å—Ç—ã">
        <i class="fas fa-music" aria-hidden="true"></i>
        <span>–°–µ—Ç-–ª–∏—Å—Ç—ã</span>
    </button>
    <button id="toggle-my-list" class="mobile-nav-button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–æ–π —Å–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω" title="–ú–æ–∏">
        <i class="fas fa-heart" aria-hidden="true"></i>
        <span>–ú–æ–∏</span>
    </button>
    <button id="toggle-repertoire" class="mobile-nav-button" aria-label="–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä –≤–æ–∫–∞–ª–∏—Å—Ç–æ–≤" title="–†–µ–ø–µ—Ä—Ç—É–∞—Ä">
        <i class="fas fa-microphone" aria-hidden="true"></i>
        <span>–†–µ–ø–µ—Ä—Ç—É–∞—Ä</span>
    </button>
</nav>

  <!-- New Metronome Module - No external libraries needed -->
  
  <script type="module" src="script.js"></script>
  
  <!-- –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∞–∑–∑–∏-–ø–æ–∏—Å–∫–∞ -->
  <script type="module">
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫
    import searchEngine from './src/js/search/searchEngine.js';
    
    // –î–µ–ª–∞–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ
    window.searchEngine = searchEngine;
    
    // –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π
    document.addEventListener('DOMContentLoaded', () => {
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª–æ–≤–∞—Ä—å
        const initSearchEngine = () => {
            if (window.state && window.state.allSongs && window.state.allSongs.length > 0) {
                searchEngine.initializeDictionary(window.state.allSongs);
                console.log('üîç –§–∞–∑–∑–∏-–ø–æ–∏—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                // –ü–æ–≤—Ç–æ—Ä—è–µ–º —á–µ—Ä–µ–∑ 500ms –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                setTimeout(initSearchEngine, 500);
            }
        };
        
        initSearchEngine();
    });
  </script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .then(registration => {
              console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
            })
            .catch(error => {
              console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
            });
        });
      }
    </script>
<!-- === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –û–í–ï–†–õ–ï–ò (–ü–û–í–ï–†–• –í–°–ï–ì–û) === -->

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–µ—Ç-–ª–∏—Å—Ç–∞ -->
<div id="create-setlist-modal" class="global-overlay">
    <div class="overlay-content create-setlist-content">
        <div class="overlay-header">
            <div class="header-info">
                <i class="fas fa-plus-circle"></i>
                <div>
                    <h3>–°–æ–∑–¥–∞—Ç—å —Å–µ—Ç-–ª–∏—Å—Ç</h3>
                    <p>–®–∞–≥ 1 –∏–∑ 2: –ù–∞–∑–≤–∞–Ω–∏–µ</p>
                </div>
            </div>
            <button id="close-create-modal" class="overlay-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="overlay-body">
            <div class="input-section">
                <label for="new-setlist-name-input" class="modern-label">
                    <i class="fas fa-list"></i>
                    –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç-–ª–∏—Å—Ç–∞
                </label>
                <input 
                    type="text" 
                    id="new-setlist-name-input" 
                    class="modern-input"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–æ—Å–∫—Ä–µ—Å–Ω–æ–µ —Å–ª—É–∂–µ–Ω–∏–µ, –ú–æ–ª–æ–¥–µ–∂–∫–∞..."
                    maxlength="50"
                >
                <div class="input-hint">
                    <span id="name-char-count">0</span>/50 —Å–∏–º–≤–æ–ª–æ–≤
                </div>
            </div>
        </div>
        
        <div class="overlay-footer">
            <button id="cancel-create-setlist" class="btn-modern secondary">
                <i class="fas fa-times"></i>
                <span>–û—Ç–º–µ–Ω–∞</span>
            </button>
            <button id="create-setlist-button" class="btn-modern primary">
                <i class="fas fa-arrow-right"></i>
                <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Å–µ–Ω -->
<div id="add-songs-confirm-modal" class="global-overlay">
    <div class="overlay-content confirm-content">
        <div class="overlay-header">
            <div class="header-info">
                <i class="fas fa-music"></i>
                <div>
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω–∏?</h3>
                    <p>–°–µ—Ç-–ª–∏—Å—Ç "<span id="created-setlist-name"></span>" —Å–æ–∑–¥–∞–Ω</p>
                </div>
            </div>
            <button id="close-confirm-modal" class="overlay-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="overlay-body">
            <div class="confirm-section">
                <div class="confirm-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                <div class="confirm-text">
                    <h4>–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω–∏ —Å–µ–π—á–∞—Å?</h4>
                    <p>–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω–∏ –≤ —Å–µ—Ç-–ª–∏—Å—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –ø–æ–∑–∂–µ</p>
                </div>
            </div>
        </div>
        
        <div class="overlay-footer">
            <button id="skip-add-songs" class="btn-modern secondary">
                <i class="fas fa-check"></i>
                <span>–ü–æ–∫–∞ –Ω–µ—Ç</span>
            </button>
            <button id="start-add-songs" class="btn-modern primary">
                <i class="fas fa-plus"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω–∏</span>
            </button>
        </div>
    </div>
</div>

<!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –æ–≤–µ—Ä–ª–µ–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Å–µ–Ω -->
<div id="add-songs-overlay" class="global-fullscreen-overlay">
    <div class="fullscreen-content">
        <div class="fullscreen-header">
            <div class="header-top-row">
                <div class="header-left">
                    <button id="close-add-songs" class="overlay-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="header-title">
                        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω–∏</h3>
                    </div>
                </div>
                <div class="header-right">
                    <div class="added-counter">
                        <i class="fas fa-music"></i>
                        <span id="added-songs-count">0</span>
                    </div>
                    <button id="finish-adding-songs" class="btn-modern primary">
                        <i class="fas fa-check"></i>
                        <span>–ì–æ—Ç–æ–≤–æ</span>
                    </button>
                </div>
            </div>
            <div class="header-subtitle">
                <span>–≤ —Å–µ—Ç-–ª–∏—Å—Ç "</span><span id="target-setlist-name" class="setlist-name"></span><span>"</span>
            </div>
        </div>
        
        <div class="fullscreen-body">
            <div class="search-section">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input 
                            type="text" 
                            id="song-search-input" 
                            class="search-input"
                            placeholder="–ü–æ–∏—Å–∫ –ø–µ—Å–µ–Ω –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                        >
                        <button id="clear-search" class="clear-search-btn" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-filters">
                        <select id="category-filter" class="filter-select">
                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        </select>
                        <button id="show-added-only" class="filter-btn">
                            <i class="fas fa-check-circle"></i>
                            <span>–ü–æ–∫–∞–∑–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="results-section">
                <div id="songs-grid" class="songs-grid">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Å–µ–Ω...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ -->
<div id="key-selection-modal" class="global-overlay">
    <div class="overlay-content key-selection-content">
        <div class="overlay-header">
            <div class="header-info">
                <i class="fas fa-music"></i>
                <div>
                    <h3>–í—ã–±–æ—Ä —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h3>
                    <p id="key-song-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏</p>
                </div>
            </div>
            <button id="close-key-modal" class="overlay-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="overlay-body">
            <div class="key-section">
                <div class="current-key-info">
                    <div class="key-info-item">
                        <label>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</label>
                        <span id="original-key" class="key-badge original">C</span>
                    </div>

                </div>
                
                <div class="keys-grid">
                    <button class="key-btn" data-key="C">C</button>
                    <button class="key-btn" data-key="C#">C#</button>
                    <button class="key-btn" data-key="D">D</button>
                    <button class="key-btn" data-key="D#">D#</button>
                    <button class="key-btn" data-key="E">E</button>
                    <button class="key-btn" data-key="F">F</button>
                    <button class="key-btn" data-key="F#">F#</button>
                    <button class="key-btn" data-key="G">G</button>
                    <button class="key-btn" data-key="G#">G#</button>
                    <button class="key-btn" data-key="A">A</button>
                    <button class="key-btn" data-key="A#">A#</button>
                    <button class="key-btn" data-key="B">B</button>
                </div>
                

            </div>
        </div>
        
        <div class="overlay-footer">
            <button id="cancel-key-selection" class="btn-modern secondary">
                <i class="fas fa-times"></i>
                <span>–û—Ç–º–µ–Ω–∞</span>
            </button>
            <button id="confirm-key-selection" class="btn-modern primary">
                <i class="fas fa-check"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é</span>
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–±–∏–ª—å–Ω—ã–π overlay –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Å–Ω–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ -->
<div id="mobile-song-preview-overlay" class="global-fullscreen-overlay">
    <div class="fullscreen-content">
        <div class="fullscreen-header">
            <div class="header-top-row">
                <div class="header-left">
                    <button id="close-mobile-song-preview" class="overlay-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="header-title">
                        <h3 id="mobile-song-title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏</h3>
                    </div>
                </div>
                <div class="header-right">
                    <button id="add-song-to-setlist-mobile" class="btn-modern primary">
                        <i class="fas fa-plus"></i>
                        <span>–î–æ–±–∞–≤–∏—Ç—å</span>
                    </button>
                </div>
            </div>
            <div class="header-subtitle">
                <span>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: </span>
                <select id="mobile-key-selector" class="key-selector-mobile">
                    <option value="C">C (–î–æ)</option>
                    <option value="C#">C# (–î–æ#)</option>
                    <option value="D">D (–†–µ)</option>
                    <option value="D#">D# (–†–µ#)</option>
                    <option value="E">E (–ú–∏)</option>
                    <option value="F">F (–§–∞)</option>
                    <option value="F#">F# (–§–∞#)</option>
                    <option value="G">G (–°–æ–ª—å)</option>
                    <option value="G#">G# (–°–æ–ª—å#)</option>
                    <option value="A">A (–õ—è)</option>
                    <option value="A#">A# (–õ—è#)</option>
                    <option value="B">B (–°–∏)</option>
                </select>
            </div>
        </div>
        
        <div class="fullscreen-body">
            <div class="mobile-song-content">
                <div id="mobile-song-text" class="song-text-display">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ —Å –∞–∫–∫–æ—Ä–¥–∞–º–∏ -->
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
