/* ======================================== */
/* Styles for Agape Worship - v2.3      */
/* ПРИНУДИТЕЛЬНО ГОРИЗОНТАЛЬНЫЕ ПОЛЯ НА МОБИЛЬНЫХ */

/* КРИТИЧЕСКИЙ ФИКС ДЛЯ SAMSUNG S23 ULTRA И ДРУГИХ БОЛЬШИХ СМАРТФОНОВ */
/* Перенесено в соответствующие медиа-запросы для предотвращения конфликтов */
/* Версия включает:                     */
/* - Рефакторинг панелей                */
/* - Режим Презентации v2               */
/* - Темы + Переключение                */
/* - Визуальные улучшения               */
/* - Исправление SVG URL                */
/* - Исправление контраста кнопок       */
/* - Улучшение видимости кнопок презент.  */
/* - !!! ИЗМЕНЕНИЯ CSS ДЛЯ РАЗДЕЛЕНИЯ ПАНЕЛЕЙ И 3 КНОПОК НАВИГАЦИИ !!! */
/* - !!! ИСПРАВЛЕНИЕ КНОПОК СЕТ-ЛИСТА !!! */
/* - !!! КОРРЕКЦИЯ РАЗМЕРОВ В ПРЕЗЕНТАЦИИ !!! */
/* - !!! ИСПРАВЛЕНИЕ СТРУКТУРЫ CSS + НОВЫЕ КНОПКИ !!! */
/* ======================================== */

/* --- Theme Variables --- */
:root {
    /* Dark Theme (Default) */
    --primary-color: #22d3ee;
    --secondary-color: #06b6d4;
    --background-color: #111827;
    --container-background-color: #1f2937;
    --text-color: #e5e7eb;
    --border-color: #374151;
    --hover-color: #374151;
    --shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
    --radius: 8px;
    --accent-color: #67e8f9;
    --danger-color: #fb7185;
    --button-text-color: #111827;
    --link-color: var(--accent-color);
    --input-bg-color: #374151;
    --label-color: #9ca3af;
    --glow-color: rgba(34, 211, 238, 0.4);
}

/* --- Light Theme Variables --- */
body[data-theme="light"] {
    --primary-color: #339af0;
    --secondary-color: #1c7ed6;
    --background-color: #f1f5f9;
    --container-background-color: #ffffff;
    --text-color: #1e293b;
    --border-color: #cbd5e1;
    --hover-color: #e2e8f0;
    --shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
    /* --radius: 8px; */
    --accent-color: #1c7ed6;
    --danger-color: #f43f5e;
    --button-text-color: #ffffff;
    --link-color: var(--accent-color);
    --input-bg-color: #ffffff;
    --label-color: #475569;
    --glow-color: rgba(28, 126, 214, 0.3);
}
/* Принудительно убираем фоновые артефакты в светлой теме */
html[data-theme="light"], 
body[data-theme="light"] {
    background-image: none !important;
    background-attachment: scroll !important;
}

/* --- Base Styles --- */
/* Принудительно устраняем любые фоновые артефакты */
* {
    box-sizing: border-box;
}
*:not(select):not(button):not(input):not(textarea) {
    background-image: none !important;
}
html {
    background: var(--background-color) !important;
    background-image: none !important;
    margin: 0;
    padding: 0;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
    margin: 0; padding: 0; 
    background: var(--background-color);
    background-image: none !important; /* Принудительно убираем любые фоновые изображения */
    background-attachment: scroll !important; /* Убираем fixed фоны */
    background-repeat: no-repeat !important;
    color: var(--text-color);
    line-height: 1.6;
    min-height: 100vh;
    padding-bottom: 70px;
    transition: background-color 0.3s ease, color 0.3s ease;
}
.container {
    max-width: 600px; margin: 15px auto; padding: 12px; /* Уменьшили margin с 25px до 15px, padding с 20px до 12px */
    box-shadow: none; border-radius: var(--radius);
    background: var(--container-background-color); position: relative;
    transition: background-color 0.3s ease;
    border: 1px solid var(--border-color); /* Добавляем простую границу вместо тени */
}

/* --- Header --- */
header {
    display: flex; justify-content: center; align-items: center;
    position: relative; padding: 8px 20px; margin-bottom: 8px;
}
h1 {
    text-align: center; color: var(--text-color); margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
    text-transform: uppercase; letter-spacing: 1.5px;
    animation: glow 3s infinite alternate;
    transition: color 0.3s ease;
}
@keyframes glow {
    from { text-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); }
    to   { text-shadow: 0 0 10px var(--glow-color), 0 0 15px var(--glow-color); }
}
body[data-theme="light"] h1 {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    animation: none;
}

/* --- Theme Toggle Switch --- */
#theme-toggle-button {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    width: 60px;
    height: 30px;
    background: var(--border-color);
    border: none;
    border-radius: 15px;
    cursor: pointer;
    padding: 3px;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.8rem;
    overflow: hidden;
}

#theme-toggle-button:hover {
    background: color-mix(in srgb, var(--border-color) 80%, var(--text-color));
}

.theme-toggle-slider {
    position: absolute;
    width: 24px;
    height: 24px;
    background: var(--primary-color);
    border-radius: 50%;
    transition: transform 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--button-text-color);
    font-size: 0.7rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

body[data-theme="dark"] .theme-toggle-slider {
    transform: translateX(0);
}

body[data-theme="light"] .theme-toggle-slider {
    transform: translateX(30px);
}

.theme-icon {
    position: absolute;
    font-size: 0.7rem;
    transition: opacity 0.3s ease;
}

.theme-icon.moon {
    left: 8px;
    color: #60a5fa;
}

.theme-icon.sun {
    right: 8px;
    color: #fbbf24;
}

body[data-theme="dark"] .theme-icon.sun {
    opacity: 0.4;
}

body[data-theme="dark"] .theme-icon.moon {
    opacity: 1;
}

body[data-theme="light"] .theme-icon.sun {
    opacity: 1;
}

body[data-theme="light"] .theme-icon.moon {
    opacity: 0.4;
}

/* --- Headings --- */
#song-title { /* Заголовок песни как legend */
    font-size: 1.0rem; /* Уменьшили размер шрифта */
    font-weight: 600;
    color: var(--text-color);
    letter-spacing: 0.5px;
    padding: 0 12px; /* Стандартные отступы как у других legend */
    background: var(--container-background-color);
    transition: color 0.3s ease;
    text-align: center; /* Выравнивание по центру */
    margin: 0; /* Убираем лишние отступы */
    display: flex; /* Flexbox для размещения кнопки */
    align-items: center; /* Центрируем по вертикали */
    justify-content: center; /* Центрируем по горизонтали */
    gap: 10px; /* Отступ между названием и кнопкой */
}

.song-title-text {
    /* Стили для текста названия песни */
    flex: 1; /* Занимает доступное пространство */
    text-align: center; /* Центрируем текст */
}

.legend-button {
    /* Специальные стили для кнопки в legend */
    width: 28px !important; /* Компактный размер */
    height: 28px !important;
    font-size: 0.8rem !important; /* Маленькая иконка */
    flex-shrink: 0; /* Не сжимается */
    opacity: 0.8; /* Полупрозрачная */
    transition: opacity 0.2s ease;
}

.legend-button:hover {
    opacity: 1; /* Полностью видимая при наведении */
}

/* Заголовки секций в панелях (h3) */
.list-section h3, #repertoire-panel .panel-header {
     text-align: center;
     font-size: 1.1rem;
     color: var(--primary-color);
     margin-top: 0;
     margin-bottom: 8px;   /* Оставляем уменьшенный нижний отступ */
     padding-top: 0;
     padding-bottom: 6px;
     border-bottom: 1px solid var(--border-color);
}
#repertoire-panel .panel-header { /* Особый стиль для заголовка Репертуара */
     text-align: center;
     font-size: 1.15rem;
     color: var(--primary-color);
}
/* Заголовок текущего сет-листа */
#current-setlist-title {
    text-align: center; font-size: 1.1rem; font-weight: 600;
    color: var(--text-color); margin-bottom: 10px;
    padding: 5px; border-bottom: none; /* Убираем границу */
    background-color: var(--input-bg-color); border-radius: var(--radius);
    white-space: normal; overflow-wrap: break-word; word-break: break-word;
}


/* --- Forms --- */
.controls { display: flex; flex-direction: column; gap: 8px; margin-bottom: 8px; } /* Уменьшили gap и margin с 12px до 8px */
.control-group { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.control-group label { font-size: 0.8rem; color: var(--label-color); margin-bottom: 4px; flex-basis: 100%; text-transform: uppercase; letter-spacing: 0.5px; transition: color 0.3s ease;}

/* Контейнер для фильтров с компактными div */
.select-filters-container { display: flex; gap: 12px; flex-wrap: nowrap !important; flex-direction: row !important; margin-bottom: 0px; } /* Увеличили gap с 8px до 12px для лучшего разделения панелей */
.filter-group { 
    flex: 1; 
    min-width: 0; 
    border: 1px solid var(--border-color); 
    border-radius: var(--radius); 
    padding: 8px 12px; /* Упрощенный padding как у обычного input */
    margin: 0; 
    background: var(--input-bg-color); /* Такой же фон, как у поля поиска */
    transition: border-color 0.3s ease, background-color 0.3s ease; 
    height: 38px; /* Такая же высота как у input поля поиска */
    box-sizing: border-box;
    display: flex;
    align-items: center; /* Центрируем содержимое по вертикали */
}

/* Селекты внутри div должны заполнять всю область */
.select-filters-container .filter-group select {
    width: 100%;
    height: 100%; /* Заполняем всю высоту родительского div */
    padding: 0 4px;
    padding-right: 18px;
    border: none;
    background: transparent; /* Прозрачный фон для чистого вида */
    font-size: 1rem; /* Увеличили размер текста с 0.925rem до 1rem для лучшей читаемости */
    outline: none; /* Убираем outline при фокусе, так как родительский div имеет свою границу */
}

select, input[type="text"] {
    padding: 8px 12px; font-size: 0.95rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius); transition: all 0.2s ease; outline: none;
    appearance: none; background: var(--input-bg-color); color: var(--text-color);
    width: 100%; box-sizing: border-box;
    height: 38px; /* Единая высота для всех элементов управления */
}

/* Селекты внутри fieldset должны быть меньше, чтобы была видна рамка */
.select-filters-container .filter-group select {
    height: 22px; /* Правильная высота для планшетов */
    padding: 1px 4px;
    padding-right: 16px;
    font-size: 1rem; /* Увеличили размер текста для планшетов */
}
select {
    /* Стрелка для темной темы (#e5e7eb = %23e5e7eb) */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23e5e7eb'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 8px center;
    background-size: 14px; padding-right: 30px; cursor: pointer;
}
/* Стрелка select в светлой теме (#475569 = %23475569) */
body[data-theme="light"] select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23475569'%3E%3Cpath fill-rule='evenodd' d='M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z' clip-rule='evenodd' /%3E%3C/svg%3E");
}

select:disabled { opacity: 0.6; cursor: not-allowed; }
input:focus, select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent);
}

#sheet-select, #song-select { width: auto; flex-grow: 1; min-width: 140px;}
/* Поисковая группа как fieldset */
.search-group {
    position: relative;
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    padding: 4px 8px 8px 8px; /* Возвращаем исходные отступы для естественного вида */
    margin: 0 0 -3px 0; /* ОТРИЦАТЕЛЬНЫЙ margin для еще большего сближения с фильтрами */
    background: transparent;
    transition: border-color 0.3s ease;
}

.search-group legend {
    font-size: 0.75rem; /* Увеличили размер текста для legend поиска */
    color: var(--label-color);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 0 12px; /* Стандартные отступы как у других legend */
    background: var(--container-background-color);
    border-radius: 2px;
    transition: color 0.3s ease;
}

.search-group #search-input {
    width: 100%;
    max-width: none;
    min-width: 0;
    margin-bottom: 0;
}

/* Контейнер для списка результатов */
#search-results {
    position: absolute; top: 100%; left: 0; right: 0; width: 100%;
    max-height: 210px; overflow-y: auto;
    background-color: var(--container-background-color);
    border-bottom-left-radius: var(--radius); border-bottom-right-radius: var(--radius);
    z-index: 10; box-sizing: border-box; margin-top: -1px;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* Рамка показывается только когда есть результаты */
#search-results:not(:empty) {
    border: 1px solid var(--border-color); 
    border-top: none;
    box-shadow: none;
}
#search-results::-webkit-scrollbar { width: 6px; }
#search-results::-webkit-scrollbar-track { background: var(--input-bg-color); border-radius: 3px;}
#search-results::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 3px;}


/* Отдельный элемент результата поиска */
.search-result {
    padding: 10px 15px; cursor: pointer; color: var(--text-color);
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s ease, color 0.3s ease, border-color 0.3s ease;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.9rem;
}
.search-result:last-child { border-bottom: none; border-bottom-left-radius: var(--radius); border-bottom-right-radius: var(--radius); }
.search-result:hover { background-color: var(--hover-color); }


/* --- Buttons --- */
button {
    display: inline-flex; align-items: center; justify-content: center;
    background: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
    color: var(--button-text-color) !important;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15), inset 0 1px 1px color-mix(in srgb, white 10%, transparent);
    font-weight: 500; cursor: pointer; border: none;
    border-radius: var(--radius);
    transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease;
    padding: 9px 16px; font-size: 0.9rem; line-height: 1.4;
    text-decoration: none; vertical-align: middle;
}
button:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), inset 0 1px 1px color-mix(in srgb, white 10%, transparent); }
button:active:not(:disabled) { transform: translateY(0px); box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15); }
button:disabled { opacity: 0.5; cursor: not-allowed; background: color-mix(in srgb, var(--border-color) 50%, transparent); box-shadow: none; color: color-mix(in srgb, var(--text-color) 50%, transparent) !important; }

/* Кнопки-иконки */
button.icon-button { padding: 0; width: 38px; height: 38px; font-size: 1rem; line-height: 1; flex-shrink: 0; overflow: hidden; display: inline-flex; align-items: center; justify-content: center; }
button.icon-button.simple { background: transparent; box-shadow: none; border: 1px solid var(--border-color); color: var(--text-color) !important; /* Явный цвет для темной темы */ transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease; }
button.icon-button.simple:hover:not(:disabled) { background: var(--hover-color); border-color: color-mix(in srgb, var(--border-color) 80%, black); color: var(--text-color) !important; transform: none; box-shadow: none; }
button.icon-button.simple:active:not(:disabled) { background: var(--primary-color); color: var(--button-text-color) !important; border-color: var(--primary-color); transform: translateY(1px); box-shadow: none; }
/* Переопределение для светлой темы */
body[data-theme="light"] button.icon-button.simple { color: var(--label-color) !important; border-color: var(--border-color); }
body[data-theme="light"] button.icon-button.simple:hover:not(:disabled) { background: var(--hover-color); border-color: color-mix(in srgb, var(--border-color) 80%, #475569); color: var(--text-color) !important; }
body[data-theme="light"] button.icon-button.simple:active:not(:disabled) { background: var(--primary-color); color: var(--button-text-color) !important; border-color: var(--primary-color); }



/* Ряд Тональность/Разделить/Масштаб */
.control-group:has(#key-select) { 
    align-items: center; 
    min-height: 38px; 
    gap: 12px; 
    margin-bottom: -3px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с областью песни */
    margin-top: 25px; /* УМЕРЕННОЕ разделение: достаточно для визуального разделения */
    padding-top: 15px; /* Небольшой отступ сверху */
    position: relative;
}

/* Элегантная тонкая линия разделения */
.control-group:has(#key-select)::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, 
        transparent 0%, 
        var(--border-color) 20%, 
        var(--primary-color) 50%, 
        var(--border-color) 80%, 
        transparent 100%);
    opacity: 0.6;
}

/* Fieldset для тональности */
.key-group {
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    padding: 3px 8px 8px 8px; /* Компактный padding */
    margin: 0;
    background: transparent;
    transition: border-color 0.3s ease;
    height: 38px;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    flex-shrink: 0;
}
.key-group legend {
    display: none; /* Скрываем legend элемент полностью */
}
#key-select { padding: 0 15px 0 15px; font-size: 0.9rem; width: 100%; min-width: 60px; text-align: center; height: 21px; border: none; background: transparent; margin: 0; flex-shrink: 0; }

/* Группировка функциональных кнопок */
.function-buttons-group {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 12px;
    border-left: 1px solid color-mix(in srgb, var(--border-color) 50%, transparent);
    border-right: 1px solid color-mix(in srgb, var(--border-color) 50%, transparent);
    margin: 0 8px;
    transition: border-color 0.3s ease;
}
#split-text-button { /* Кнопка Разделить текст в ОСНОВНОМ окне */ /* Она НЕ simple */ padding: 0 12px; height: 38px; font-size: 0.85rem; flex-shrink: 0; }
#split-text-button i { margin-right: 6px; font-size: 0.9em; }
.font-size-controls { margin-left: auto; display: flex; align-items: center; gap: 5px; }
/* #zoom-in, #zoom-out наследуют стили .icon-button и .icon-button.simple */

/* Кнопки под песней */
.control-buttons { display: flex; justify-content: center; gap: 12px; margin-top: 20px; flex-wrap: wrap; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease;}
.control-buttons button { padding: 8px 14px; font-size: 0.85rem; flex: 0 1 auto; }

/* Нижний ряд управления */
.controls-footer { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; padding-top: 0;}
.bpm-controls { display: flex; align-items: center; gap: 8px; }
.bpm-controls span:not(#bpm-display) { font-size: 0.8rem; color: var(--label-color); text-transform: uppercase; transition: color 0.3s ease;}
.bpm-controls #time-signature { padding: 8px 10px; font-size: 0.85rem; min-width: 65px; height: 38px; }
.bpm-controls #bpm-display { padding: 8px 10px; min-width: 55px; font-size: 0.9rem; cursor: text; border: 1px solid var(--border-color); background-color: var(--input-bg-color); border-radius: var(--radius); text-align: center; color: var(--text-color); height: 38px; line-height: normal; display: inline-block; box-sizing: border-box; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
#metronome-button { padding: 0 12px; min-width: auto; height: 38px; flex-shrink: 0; font-size: 0.85rem; }
#metronome-button i { margin-right: 6px; font-size: 0.9em; }
#add-to-repertoire-button { padding: 8px 12px; height: 38px; font-size: 0.85rem; }
#holychords-button { display: inline-flex; align-items: center; padding: 0 12px; height: 38px; font-size: 0.85rem; color: var(--link-color); text-decoration: none; border: 1px solid var(--link-color); border-radius: var(--radius); transition: all 0.3s ease; background: transparent; box-shadow: none; font-weight: 500; box-sizing: border-box; }
#holychords-button:hover { background-color: var(--link-color); color: var(--button-text-color); transform: none; box-shadow: none; }
body[data-theme="light"] #holychords-button:hover { color: #fff; }


/* --- Отображение Песни --- */
#song-content { 
    background: var(--container-background-color); 
    padding: 10px 12px 15px 12px; /* Уменьшили отступы с 15px 20px 20px 20px */
    border-radius: var(--radius); 
    box-shadow: none; 
    margin-top: 0px; /* МАКСИМАЛЬНОЕ сближение: убираем margin-top полностью */
    position: relative; 
    overflow: hidden; 
    border: 1px solid var(--border-color); 
    transition: background-color 0.3s ease, border-color 0.3s ease;
    /* Убираем лишние margin у fieldset */
    margin-left: 0;
    margin-right: 0;
}
#song-content pre { 
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; /* ВОЗВРАЩАЕМ исходный шрифт */
    white-space: pre; /* pre для точного позиционирования */
    word-wrap: normal; /* отключаем word-wrap */
    line-height: 1.3; /* Уменьшили с 1.5 до 1.3 для стандартизации межстрочных интервалов */
    font-size: var(--lyrics-font-size, 1rem); 
    color: var(--text-color); 
    margin: 0; 
    padding-top: 6px; 
    overflow-x: auto; 
    transition: color 0.3s ease;
    letter-spacing: 0; /* убираем letter-spacing */
    word-spacing: 0; /* убираем word-spacing */
    tab-size: 1; /* КРИТИЧНО: размер табуляции */
    -moz-tab-size: 1; /* для Firefox */
    font-variant-numeric: tabular-nums; /* моноширинные цифры */
}
#song-content .chord {
    font-weight: 700 !important;
    color: var(--primary-color);
    display: inline; /* inline для точного позиционирования */
    background-color: color-mix(in srgb, var(--accent-color) 2%, transparent); /* ВОЗВРАЩАЕМ еле заметный фон */
    padding: 1px 2px; /* МИНИМАЛЬНЫЙ padding для фона */
    border-radius: 3px; /* ВОЗВРАЩАЕМ скругления для фона */
    margin: 0; /* margin остается 0 */
    line-height: inherit; /* наследуем line-height от родителя */
    vertical-align: baseline; /* Выравнивание по базовой линии */
    transition: color 0.3s ease, background-color 0.3s ease;
}
/* Стили аккордов в светлой теме */
body[data-theme="light"] #song-content .chord {
    color: var(--secondary-color);
    background-color: color-mix(in srgb, var(--accent-color) 5%, transparent);
}

/* СТАРЫЕ СТИЛИ ДВУХКОЛОНОЧНОГО РЕЖИМА - ОТКЛЮЧЕНЫ */
/* #song-content.split-columns pre { column-count: 2; column-gap: 30px; position: relative;}
#song-content.split-columns pre::before { content: ""; position: absolute; top: 0; bottom: 0; left: 50%; width: 1px; background-color: var(--border-color); transform: translateX(-50%); z-index: 1; transition: background-color 0.3s ease; } */

/* --- YouTube Player --- */
#youtube-player-section { max-width: 600px; margin: 25px auto 15px auto; }
#youtube-player-section h3 { text-align: center; margin-bottom: 15px; font-size: 1.1rem; font-weight: 500; color: var(--text-color); border: none; padding: 0; transition: color 0.3s ease;}
#youtube-player-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000; border-radius: var(--radius); margin-bottom: 15px; }
#youtube-player-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
#youtube-video-key-display { text-align: center; margin-bottom: 10px; font-size: 0.85rem; color: var(--label-color); transition: color 0.3s ease; }


/* ============================================ */
/* СТИЛИ ДЛЯ РЕЖИМА ПРЕЗЕНТАЦИИ                */
/* ============================================ */
.presentation-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--background-color); z-index: 2000; display: none; scroll-behavior: smooth; overflow-y: hidden; transition: background-color 0.3s ease; }
.presentation-overlay.visible { display: block; }
.presentation-content { padding: 20px 15px 70px 15px; /* Уменьшил вертикальные паддинги */ max-width: 950px; margin: 0 auto; height: 100%; overflow-y: auto; box-sizing: border-box; }
.presentation-content::-webkit-scrollbar { width: 8px; }
.presentation-content::-webkit-scrollbar-track { background: var(--hover-color); border-radius: 4px;}
.presentation-content::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 4px;}
.presentation-song { margin-bottom: 0; border-bottom: none; }

/* --- ИЗМЕНЕНИЯ ДЛЯ ПРЕЗЕНТАЦИИ --- */
/* Заголовок песни в презентации */
.presentation-song h2 {
    font-size: 1.0rem;
    color: var(--accent-color);
    text-align: center;
    margin-top: 0;
    margin-bottom: 5px;
    font-weight: 500;
    line-height: 1.25;
    transition: color 0.3s ease;
}
/* Заметки в презентации */
.presentation-notes {
    background-color: transparent;
    border-left: none;
    padding: 0 5px;
    margin-top: 0;
    margin-bottom: 8px;
    border-radius: 0;
    font-size: 0.8em;
    line-height: 1.3;
    color: var(--label-color);
    white-space: pre-wrap;
    text-align: center !important;
    transition: color 0.3s ease;
    display: block; /* Убедимся, что это блок */
    width: 100%; /* Занимает всю ширину для центрирования текста */
    box-sizing: border-box;
}
.presentation-notes i.fas {
    margin-right: 4px;
    font-size: 0.9em;
    color: var(--label-color);
    opacity: 0.9;
    vertical-align: middle;
}
/* Стили для светлой темы заметки */
body[data-theme="light"] .presentation-notes {
    background-color: transparent;
    color: #5f6b7e;
}
body[data-theme="light"] .presentation-notes i.fas {
    color: #5f6b7e;
}

/* Текст песни в презентации */
.presentation-song pre {
    font-size: clamp(12px, 2.9vw, 17px);
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; /* ВОЗВРАЩАЕМ исходный шрифт */
    line-height: 1.3; /* Стандартизируем с основным текстом */
    white-space: pre; /* pre для точного позиционирования */
    word-wrap: normal; /* отключаем word-wrap */
    color: var(--text-color);
    transition: color 0.3s ease;
    margin-top: 0;
    letter-spacing: 0; /* убираем letter-spacing */
    word-spacing: 0; /* убираем word-spacing */
    tab-size: 1; /* КРИТИЧНО: размер табуляции */
    -moz-tab-size: 1; /* для Firefox */
    font-variant-numeric: tabular-nums; /* моноширинные цифры */
}

/* --- Стиль аккордов в презентации (с фоном) --- */
.presentation-song .chord {
    font-weight: 700 !important;
    color: var(--primary-color);
    display: inline; /* inline для точного позиционирования */
    background-color: color-mix(in srgb, var(--accent-color) 2%, transparent); /* ВОЗВРАЩАЕМ еле заметный фон */
    padding: 1px 2px; /* МИНИМАЛЬНЫЙ padding для фона */
    border-radius: 3px; /* ВОЗВРАЩАЕМ скругления для фона */
    margin: 0; /* margin остается 0 */
    line-height: inherit; /* наследуем line-height */
    vertical-align: baseline;
    transition: color 0.3s ease, background-color 0.3s ease;
}
/* Стили аккордов в светлой теме презентации */
body[data-theme="light"] .presentation-song .chord {
    color: var(--secondary-color);
    background-color: color-mix(in srgb, var(--accent-color) 5%, transparent);
}
/* --- КОНЕЦ ИЗМЕНЕНИЙ ДЛЯ ПРЕЗЕНТАЦИИ --- */

/* Управление Презентацией */
.presentation-close-btn { position: fixed; top: 15px; right: 15px; z-index: 2003; background: rgba(80, 80, 80, 0.8); color: #fff; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 50%; width: 38px; height: 38px; font-size: 1.4rem; line-height: 1; padding: 0; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: none; transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease; }
.presentation-close-btn:hover { background-color: rgba(100, 100, 100, 0.9); border-color: rgba(255, 255, 255, 0.5); }
.presentation-close-btn:active { background-color: rgba(60, 60, 60, 0.9); }
.presentation-control-btn { position: fixed; top: 15px; z-index: 2001; background: rgba(80, 80, 80, 0.8); color: #fff; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 50%; width: 38px; height: 38px; font-size: 1rem; line-height: 1; padding: 0; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: none; transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease; }
.presentation-control-btn:hover { background-color: rgba(100, 100, 100, 0.9); border-color: rgba(255, 255, 255, 0.5); }
.presentation-control-btn:active { background-color: rgba(60, 60, 60, 0.9); }
#pres-split-text-btn { right: 63px; }
/* Стили для светлой темы кнопок презентации */
body[data-theme="light"] .presentation-close-btn,
body[data-theme="light"] .presentation-control-btn { background: rgba(50, 50, 50, 0.8); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); }
body[data-theme="light"] .presentation-close-btn:hover,
body[data-theme="light"] .presentation-control-btn:hover { background-color: rgba(80, 80, 80, 0.9); border-color: rgba(255, 255, 255, 0.4); }
body[data-theme="light"] .presentation-close-btn:active,
body[data-theme="light"] .presentation-control-btn:active { background-color: rgba(30, 30, 30, 0.9); }
/* Нижняя панель управления */
.presentation-controls { position: fixed; bottom: 0; left: 0; width: 100%; background-color: rgba(20, 20, 20, 0.9); backdrop-filter: none; padding: 8px 15px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; z-index: 2002; border-top: 1px solid #444; opacity: 1; transition: opacity 0.5s ease-in-out; pointer-events: auto; }
.presentation-controls.controls-hidden { opacity: 0; pointer-events: none; }
.presentation-nav-btn { background: none; border: none; color: #f0f0f0; font-size: 1.8rem; padding: 5px 15px; cursor: pointer; transition: color 0.2s ease; line-height: 1; border-radius: 4px; }
.presentation-nav-btn:hover:not(:disabled) { color: var(--accent-color); }
.presentation-nav-btn:disabled { color: #666; cursor: not-allowed; }
.presentation-counter { color: #ddd; font-size: 0.9rem; text-align: center; }
.presentation-loading { padding: 50px 20px; text-align: center; font-size: 1.1rem; color: var(--label-color); }
/* СТАРЫЕ СТИЛИ РАЗДЕЛЕНИЯ КОЛОНОК В ПРЕЗЕНТАЦИИ - ОТКЛЮЧЕНЫ */
/* #presentation-content.split-columns .presentation-song pre { column-count: 2; column-gap: 35px; position: relative; }
#presentation-content.split-columns .presentation-song pre::before { content: ""; position: absolute; top: 0; bottom: 0; left: 50%; width: 1px; background-color: var(--border-color); transform: translateX(-50%); z-index: 1; transition: background-color 0.3s ease;}
body[data-theme="light"] #presentation-content.split-columns .presentation-song pre::before { background-color: #ccc; } */


/* ============================================ */
/* СТИЛИ ДЛЯ БОКОВЫХ ПАНЕЛЕЙ                   */
/* ============================================ */
/* НОВАЯ СИСТЕМА БОКОВЫХ ПАНЕЛЕЙ - ПОЛНАЯ ПЕРЕПИСКА */
/* ============================================ */

/* БАЗОВЫЕ СТИЛИ ПАНЕЛЕЙ */
.side-panel {
    /* КРИТИЧЕСКИ ВАЖНЫЕ РАЗМЕРЫ И ПОЗИЦИОНИРОВАНИЕ */
    position: fixed !important;
    top: 0 !important;
    bottom: 0 !important;
    width: 320px !important;
    max-width: 85vw !important;
    height: 100vh !important;
    
    /* ОФОРМЛЕНИЕ */
    background-color: var(--container-background-color);
    box-shadow: none;
    border: 1px solid var(--border-color);
    
    /* АНИМАЦИЯ */
    transition: transform 0.3s ease-in-out;
    
    /* СОДЕРЖИМОЕ */
    display: flex;
    flex-direction: column;
    padding: 15px;
    gap: 10px;
    box-sizing: border-box;
    overflow: hidden;
    
    /* Z-INDEX */
    z-index: 1000;
}

/* ЛЕВЫЕ ПАНЕЛИ */
#setlists-panel,
#my-list-panel {
    left: 0 !important;
    right: auto !important;
    transform: translateX(-100%) !important;
    border-right: 2px solid var(--primary-color) !important;
    border-left: none !important;
}

#setlists-panel.open,
#my-list-panel.open {
    transform: translateX(0) !important;
}

/* ПРАВАЯ ПАНЕЛЬ */
#repertoire-panel {
    right: 0 !important;
    left: auto !important;
    transform: translateX(100%) !important;
    border-left: 2px solid var(--primary-color) !important;
    border-right: none !important;
}

#repertoire-panel.open {
    transform: translateX(0) !important;
}

/* --- Кнопки закрытия панелей --- */
.side-panel-close-btn {
    width: 32px; height: 32px; font-size: 1rem;
    padding: 0 !important; margin: 0 !important;
    background: var(--container-background-color) !important;
    border: 1px solid var(--border-color) !important;
    color: var(--text-color) !important;
    border-radius: 50% !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
    transition: all 0.2s ease !important;
}
.side-panel-close-btn:hover {
    background: var(--hover-color) !important;
    border-color: var(--primary-color) !important;
    color: var(--primary-color) !important;
    transform: scale(1.1) !important;
}
.side-panel-close-btn:active {
    background: var(--primary-color) !important;
    color: var(--button-text-color) !important;
    transform: scale(0.95) !important;
}
.side-panel-close-btn {
    position: absolute;
    top: 8px;
    z-index: 10;
}
#setlists-panel .side-panel-close-btn,
#my-list-panel .side-panel-close-btn {
    right: 8px;
}
#repertoire-panel .side-panel-close-btn {
    left: 8px;
}

/* --- Содержимое панелей --- */
/* Общие стили для контейнеров списков */
.list-container {
    overflow-y: auto; overflow-x: hidden; margin-bottom: 10px; padding: 5px;
    border: 1px solid var(--border-color); border-radius: var(--radius);
    background: var(--background-color); /* Фон как у body для контраста */
    transition: background-color 0.3s ease, border-color 0.3s ease;
    word-wrap: break-word; /* Переносим длинные слова */
    word-break: break-word; /* Принудительно разбиваем слова если нужно */
}
.list-container::-webkit-scrollbar { width: 6px; }
.list-container::-webkit-scrollbar-track { background: var(--border-color); border-radius: 3px;}
.list-container::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 3px;}

/* Секция "Мой список" (теперь в #my-list-panel) */
#my-list-panel .list-section { margin-bottom: 0; } /* Убираем нижний отступ */
#my-list-panel #favorites-list { max-height: none; flex-grow: 1; } /* Растягиваем на всю высоту */

/* Секции внутри панели Сет-листов (#setlists-panel) */
#setlists-panel .setlist-section { /* Секция со списком сет-листов */
    flex-shrink: 0; /* Не сжимается */
}
#setlists-panel .create-setlist-form { /* Добавили класс форме в HTML? Если нет, стилизуем по-другому */
    display: flex;
    gap: 10px;
    margin-bottom: 15px; /* Отступ после формы */
}
#setlists-panel #new-setlist-name-input {
    flex-grow: 1; /* Поле ввода занимает доступное место */
}
#setlists-panel #create-setlist-button {
    flex-shrink: 0; /* Кнопка не сжимается */
}

#setlists-panel .current-setlist-section { /* Секция с выбранным сет-листом */
    flex-grow: 1; /* Занимает оставшееся место */
    display: flex; flex-direction: column;
    border-top: 1px solid var(--border-color); margin-top: 15px; padding-top: 10px;
    min-height: 150px;
}
#setlists-panel #current-setlist-songs-container { /* Контейнер песен */
    flex-grow: 1; max-height: none; /* Снимаем ограничение */
}


/* ================================================================ */
/* === СТИЛИ ДЛЯ КНОПОК "Презентация" и "Удалить" (ВЕРСИЯ 2) === */
/* ================================================================ */

/* Контейнер для кнопок "Презентация" и "Удалить" */
#setlists-panel .current-setlist-controls {
    display: flex !important;      /* Включаем Flexbox (с !important для надежности) */
    flex-wrap: wrap;             /* Позволяем переноситься */
    gap: 10px;                   /* Отступ между кнопками */
    margin-top: 10px;            /* Отступ сверху от заголовка */
    margin-bottom: 15px;         /* Отступ снизу до списка песен */
    justify-content: flex-start; /* Выравнивание по левому краю */
    width: 100%;                 /* Контейнер занимает всю ширину */
    box-sizing: border-box;
}

/* Стили для САМИХ кнопок внутри этого контейнера */
#setlists-panel .current-setlist-controls button {
    flex-grow: 0 !important;       /* Запрещаем растягиваться */
    flex-shrink: 0;                /* Запрещаем сжиматься */
    width: auto !important;        /* Ширина по контенту */
    max-width: calc(50% - 5px);    /* Макс. ширина ~половина (на случай переноса) */
    padding: 8px 15px !important;  /* Внутренние отступы (можно настроить) */
    font-size: 0.85em !important;  /* Размер шрифта (можно настроить) */
    margin: 0 !important;          /* Убираем внешние отступы от базовых стилей */
    /* Наследует border-radius и базовый градиент, если не переопределено ниже */
}

#setlists-panel .current-setlist-controls button i {
    margin-right: 6px; /* Отступ между иконкой и текстом. Можете поменять на 5px или 8px по вкусу. */
    /* vertical-align: middle; */ /* Можно добавить для выравнивания иконки по центру текста, если нужно */
}

/* Стили для кнопки "Презентация" - использует базовые стили */

/* Стили для кнопки "Удалить", чтобы выделить ее */
#setlists-panel #delete-setlist-button {
    background: var(--danger-color) !important; /* Ярко-красный фон */
    border: none !important;                 /* Убираем границу, если есть */
    color: white !important;                 /* Белый текст */
    /* Убираем тень, если она есть у базовой кнопки и мешает */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
}

#setlists-panel #delete-setlist-button:hover {
    background: color-mix(in srgb, var(--danger-color) 85%, black) !important; /* Чуть темнее при наведении */
    color: white !important;
    transform: none !important; /* Отключаем подпрыгивание, если не нужно */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) !important; /* Небольшая тень при наведении */
}
/* ================================================================ */
/* === КОНЕЦ СТИЛЕЙ ДЛЯ КНОПОК СЕТ-ЛИСТА === */
/* ================================================================ */


/* Элементы списков (Общее) */
.favorite-item, .setlist-item, .repertoire-item, .setlist-song-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 10px; border-bottom: 1px solid var(--border-color);
    font-size: 0.9rem; cursor: pointer;
    transition: background-color 0.2s ease, border-color 0.3s ease;
    overflow: hidden; /* Строго запрещаем выход за пределы */
    word-wrap: break-word; /* Переносим длинные слова */
    word-break: break-word; /* Принудительно разбиваем слова */
}
.favorite-item:last-child, .setlist-item:last-child,
.repertoire-item:last-child, .setlist-song-item:last-child { border-bottom: none; }

.favorite-item:hover, .setlist-item:hover,
.repertoire-item:hover, .setlist-song-item:hover { background-color: var(--hover-color); }

/* Имена песен/элементов */
.song-name { /* Общий класс для имени в разных списках */
    flex-grow: 1; margin-right: 10px; overflow: hidden;
    white-space: nowrap; text-overflow: ellipsis;
    color: var(--text-color); transition: color 0.3s ease;
}
.setlist-item span.setlist-name-display { /* Имя в списке сет-листов */
    flex-grow: 1; margin-right: 10px; overflow: hidden;
    white-space: nowrap; text-overflow: ellipsis;
}

/* Пустые сообщения */
.empty-message { padding: 15px; text-align: center; color: var(--label-color); font-style: italic; font-size: 0.9rem; transition: color 0.3s ease;}
.empty-message.small { font-size: 0.8rem; padding: 8px; }

/* Кнопки удаления и заметки в списках */
.remove-button, .delete-button, .edit-setlist-song-note-button {
    background: none !important; border: none !important;
    box-shadow: none !important; padding: 0 5px !important; font-size: 0.95rem !important;
    line-height: 1 !important; flex-shrink: 0; min-width: auto !important; height: auto !important;
    transition: color 0.2s ease, transform 0.2s ease !important;
    transform: none !important; cursor: pointer; border-radius: 50%;
}
/* Цвет кнопки удаления */
.remove-button, .delete-button {
    color: var(--danger-color) !important;
}
.remove-button:hover, .delete-button:hover {
    color: color-mix(in srgb, var(--danger-color) 70%, white) !important;
    transform: scale(1.15) !important;
    box-shadow: none !important; text-decoration: none;
}
.delete-song-from-setlist-button { margin-left: 5px; font-size: 0.9rem !important; }

/* Цвет кнопки заметки */
.edit-setlist-song-note-button {
    margin-left: auto; /* Отодвигаем ее и кнопку удаления вправо */
    margin-right: 5px; /* Небольшой отступ справа */
    color: var(--label-color) !important; /* Серый цвет по умолчанию */
    font-size: 0.9rem !important;
}
.edit-setlist-song-note-button.has-note i {
     color: var(--accent-color) !important; /* Цвет иконки, если есть заметка */
}
.edit-setlist-song-note-button:hover i {
     color: var(--primary-color) !important; /* Цвет при наведении */
     transform: scale(1.15) !important;
}


/* Аккордеон Репертуара */
.repertoire-key-heading { font-size: 0.9rem; font-weight: 600; color: var(--text-color); background-color: var(--input-bg-color); padding: 6px 12px; margin-top: 10px; margin-bottom: 5px; border-radius: 4px; border-left: 3px solid var(--primary-color); position: sticky; top: -1px; z-index: 1; cursor: pointer; display: flex; justify-content: space-between; align-items: center; user-select: none; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
#repertoire-panel-list > .repertoire-key-heading:first-child { margin-top: 0; }
.repertoire-key-heading i.fas { transition: transform 0.3s ease; margin-left: 10px; font-size: 0.8em; }
.repertoire-songs-for-key { overflow: hidden; transition: max-height 0.3s ease-out, opacity 0.25s ease-out, margin-top 0.3s ease-out, margin-bottom 0.3s ease-out; max-height: 800px; opacity: 1; margin-top: 5px; margin-bottom: 8px; }
.repertoire-songs-for-key.collapsed { max-height: 0; opacity: 0; margin-top: 0; margin-bottom: 0; }
.repertoire-key-heading i.fa-chevron-up { transform: rotate(180deg); }
.repertoire-songs-for-key .repertoire-item { padding-left: 15px; }
.repertoire-songs-for-key .repertoire-item:first-child { border-top: 1px dotted var(--border-color); margin-top: 5px; transition: border-color 0.3s ease;}

/* Панель Репертуара - Селектор вокалиста */
.repertoire-vocalist-selector { display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; margin-bottom: 10px; /* Добавили отступ снизу */ }
.repertoire-vocalist-selector label { font-size: 0.8rem; color: var(--label-color); text-transform: uppercase; transition: color 0.3s ease;}
#repertoire-panel #vocalist-select { width: 100%; padding: 10px 14px; padding-right: 35px; font-size: 0.95rem; background-color: var(--input-bg-color); height: 38px; box-sizing: border-box; }
#repertoire-panel-list { /* Контейнер для аккордеона */ flex-grow: 1; min-height: 100px; overflow-y: auto; margin-bottom: 0; padding: 5px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--background-color); max-height: none !important; transition: background-color 0.3s ease, border-color 0.3s ease; }
#repertoire-panel-list::-webkit-scrollbar { width: 6px; }
#repertoire-panel-list::-webkit-scrollbar-track { background: var(--border-color); border-radius: 3px;}
#repertoire-panel-list::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 3px;}
#repertoire-panel .repertoire-item .song-name { line-height: 1.4; }

/* Стили для редактирования сет-листа */
.setlist-item span.setlist-name-display { cursor: pointer; }
.setlist-edit-button { background: none !important; border: none !important; color: var(--label-color) !important; box-shadow: none !important; padding: 0 4px !important; margin: 0 !important; font-size: 0.85rem !important; line-height: 1 !important; flex-shrink: 0; min-width: auto !important; height: auto !important; cursor: pointer; opacity: 0; transition: opacity 0.2s ease, color 0.2s ease !important; }
.setlist-item:hover .setlist-edit-button { opacity: 0.7; }
.setlist-edit-button:hover { opacity: 1 !important; color: var(--accent-color) !important; }
.setlist-item input.edit-setlist-input { flex-grow: 1; font-size: 0.95rem; padding: 4px 8px; margin: -4px 0; border: 1px solid var(--primary-color); background-color: var(--input-bg-color); color: var(--text-color); border-radius: 4px; outline: none; box-shadow: 0 0 3px color-mix(in srgb, var(--primary-color) 30%, transparent); }
.setlist-item.is-editing .setlist-edit-button { display: none; }
.setlist-item.is-editing span.setlist-name-display { display: none; }


/* ============================================ */
/* НИЖНЯЯ ПАНЕЛЬ НАВИГАЦИИ                     */
/* ============================================ */
.mobile-bottom-nav {
    position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
    background-color: var(--container-background-color);
    border-top: 1px solid var(--border-color);
    box-shadow: none;
    display: flex; justify-content: space-around; align-items: stretch;
    z-index: 1000; padding: 0; box-sizing: border-box;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}
.mobile-nav-button {
    background: none; border: none; box-shadow: none; padding: 5px; margin: 0;
    font-size: 0.7rem; display: flex; flex-direction: column; align-items: center;
    justify-content: center; flex-grow: 1;
    /* !!! ИЗМЕНЕНИЕ: Адаптация под 3 кнопки !!! */
    max-width: 33.33%;
    height: 100%; cursor: pointer;
    transition: background-color 0.2s ease; border-radius: 0;
    background-image: none !important; position: relative;
}
.mobile-nav-button i { font-size: 1.3rem; margin-bottom: 3px; transition: color 0.2s ease; }
.mobile-nav-button span { transition: color 0.2s ease; }

/* Цвета для темной темы */
nav.mobile-bottom-nav .mobile-nav-button i,
nav.mobile-bottom-nav .mobile-nav-button span { color: #e5e7eb !important; }
nav.mobile-bottom-nav .mobile-nav-button:hover i,
nav.mobile-bottom-nav .mobile-nav-button:hover span,
nav.mobile-bottom-nav .mobile-nav-button:active i,
nav.mobile-bottom-nav .mobile-nav-button:active span { color: var(--accent-color) !important; }
nav.mobile-bottom-nav .mobile-nav-button:hover { background-color: var(--hover-color); }
nav.mobile-bottom-nav .mobile-nav-button:active { background-color: var(--border-color); }

/* Цвета для светлой темы */
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button i,
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button span { color: #475569 !important; }
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button:hover i,
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button:hover span,
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button:active i,
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button:active span { color: var(--accent-color) !important; }
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button:hover { background-color: var(--hover-color); }
body[data-theme="light"] nav.mobile-bottom-nav .mobile-nav-button:active { background-color: var(--border-color); }

/* Разделительные линии для средней кнопки */
#toggle-my-list { /* Новая средняя кнопка */
    border-left: 1px solid var(--border-color);
    border-right: 1px solid var(--border-color);
    transition: border-color 0.3s ease;
}


/* --- Loading Indicator --- */
#loading-indicator { display: none; position: fixed; top: 15px; left: 50%; transform: translateX(-50%); background-color: rgba(40, 40, 40, 0.9); color: white; padding: 8px 18px; border-radius: var(--radius); z-index: 1002; font-size: 0.9rem; box-shadow: none; border: 1px solid var(--border-color); }

/* --- Стили для модального окна --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.6); backdrop-filter: none;
    display: none; /* Изначально скрыто */
    justify-content: center; align-items: center;
    z-index: 2500; /* Выше чем боковые панели и презентация */
    opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
}
.modal-overlay.visible {
    display: flex; /* Показываем через flex */
    opacity: 1; pointer-events: auto;
}

.modal-content {
    background-color: var(--container-background-color); color: var(--text-color);
    padding: 25px; border-radius: var(--radius);
    box-shadow: none; min-width: 300px; max-width: 90%; width: 500px;
    position: relative; transform: scale(0.9);
    transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease;
    border: 2px solid var(--border-color); /* Добавляем границу вместо тени */
}
.modal-overlay.visible .modal-content { transform: scale(1); }

.modal-title {
    margin-top: 0; margin-bottom: 15px; font-size: 1.2rem; font-weight: 600;
    color: var(--primary-color); text-align: center;
    border-bottom: 1px solid var(--border-color); padding-bottom: 10px;
}

#note-edit-textarea {
    width: 100%; box-sizing: border-box; margin-bottom: 20px;
    padding: 10px; border-radius: var(--radius); font-size: 0.95rem;
    border: 1px solid var(--border-color); background-color: var(--input-bg-color);
    color: var(--text-color); resize: vertical; min-height: 100px;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
 #note-edit-textarea:focus {
    border-color: var(--primary-color); outline: none;
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent);
}

.modal-actions { display: flex; justify-content: flex-end; gap: 10px; }

/* .modal-button и .modal-button.primary используют базовые стили кнопок */
.modal-button.secondary {
    background: var(--hover-color) !important; color: var(--text-color) !important;
    box-shadow: none !important;
}
 .modal-button.secondary:hover {
    background: var(--border-color) !important;
    transform: none !important; box-shadow: none !important;
}

.modal-close-x {
    position: absolute; top: 10px; right: 15px; background: none; border: none;
    font-size: 1.8rem; font-weight: bold; color: var(--label-color);
    cursor: pointer; padding: 0; line-height: 1;
    transition: color 0.2s ease;
}
.modal-close-x:hover { color: var(--danger-color); }

/* ============================================ */
/* === СТИЛИ ДЛЯ НОВЫХ КНОПОК (Аккорды и Копирование) === */
/* ============================================ */

/* --- Логика скрытия аккордов --- */
#song-content.chords-hidden .chord,
.presentation-content.chords-hidden .chord {
    /* Полностью скрываем аккорды из потока документа */
    display: none !important;
}

/* Сжимаем пустые строки при скрытии аккордов */
#song-content.chords-hidden pre,
.presentation-content.chords-hidden pre {
    line-height: 1.0; /* Максимально сжимаем междустрочный интервал */
}

#song-content.chords-hidden .song-block-content,
.presentation-content.chords-hidden .song-block-content {
    line-height: 1.1; /* Чуть больше для читаемости */
}

/* Режим "только аккорды" - скрываем весь текст кроме аккордов */
#song-content.chords-only-mode,
.presentation-content.chords-only-mode {
    line-height: 2.5; /* Увеличиваем междустрочный интервал для аккордов */
}

#song-content.chords-only-mode .song-block-content,
.presentation-content.chords-only-mode .song-block-content {
    font-size: 0; /* Скрываем весь текст делая размер шрифта 0 */
    line-height: 0;
}

#song-content.chords-only-mode .chord,
.presentation-content.chords-only-mode .chord {
    font-size: var(--lyrics-font-size); /* Восстанавливаем размер шрифта для аккордов */
    line-height: 2.5; /* Устанавливаем междустрочный интервал */
    display: inline;
    background-color: color-mix(in srgb, var(--accent-color) 2%, transparent); /* Тот же еле заметный фон как у обычных аккордов */
    padding: 1px 2px; /* Минимальный padding как у обычных аккордов */
    border-radius: 3px; /* Как у обычных аккордов */
    margin: 0; /* Без отступов между аккордами */
    border: none; /* Убираем все границы */
    cursor: default !important; /* Убираем указатель для кликов */
    pointer-events: none !important; /* Полностью отключаем события мыши */
}



/* --- Кнопка Скрыть/Показать аккорды --- */
#toggle-chords-button {
    /* Наследует .icon-button и .icon-button.simple */
    padding: 0 10px; /* Паддинг для текста и иконки */
    width: auto; /* Авто-ширина по контенту */
    height: 38px; /* Такая же высота, как у соседей */
    font-size: 0.85rem;
    margin-left: 5px; /* Небольшой отступ слева */
    order: -1; /* Можно попробовать подвинуть левее кнопки Split */
    position: relative; /* Для позиционирования псевдоэлемента */
}
#toggle-chords-button i {
    margin-right: 6px; /* Отступ иконки от текста */
    font-size: 1em; /* Увеличиваем для единообразия с иконкой T */
    position: relative;
}

/* Перечеркивание кнопки скрытия аккордов - НЕ от угла до угла */
#toggle-chords-button::after {
    content: '';
    position: absolute;
    top: 25%; /* Начинаем не с самого верха */
    left: 10%; /* Начинаем не с самого левого края */
    width: 80%; /* Не на всю ширину */
    height: 50%; /* Не на всю высоту */
    background: linear-gradient(to top right, transparent 48.5%, currentColor 48.5%, currentColor 51.5%, transparent 51.5%);
    z-index: 1;
    pointer-events: none;
}

/* Активное состояние кнопки скрытия аккордов */
#toggle-chords-button.chords-hidden-active {
    background-color: var(--primary-color) !important;
    color: var(--button-text-color) !important;
    border-color: var(--primary-color) !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* --- Кнопка Только аккорды --- */
#chords-only-button {
    /* Наследует .icon-button и .icon-button.simple */
    padding: 0 10px; /* Паддинг для текста и иконки */
    width: auto; /* Авто-ширина по контенту */
    height: 38px; /* Такая же высота, как у соседей */
    font-size: 0.85rem;
    margin-left: 5px; /* Небольшой отступ слева */
    position: relative; /* Для позиционирования псевдоэлемента */
}
#chords-only-button .text-icon {
    margin-right: 6px; /* Отступ иконки от текста */
    font-size: 1em; /* Увеличиваем до размера иконки гитары */
    font-weight: 700; /* Делаем чуть жирнее для лучшей видимости */
    position: relative;
}

/* Перечеркивание кнопки "только аккорды" - НЕ от угла до угла */
#chords-only-button::after {
    content: '';
    position: absolute;
    top: 25%; /* Синхронизируем с кнопкой скрытия аккордов */
    left: 10%; /* Синхронизируем с кнопкой скрытия аккордов */
    width: 80%; /* Синхронизируем с кнопкой скрытия аккордов */
    height: 50%; /* Синхронизируем с кнопкой скрытия аккордов */
    background: linear-gradient(to top right, transparent 48.5%, currentColor 48.5%, currentColor 51.5%, transparent 51.5%);
    z-index: 1;
    pointer-events: none;
}

/* Активное состояние кнопки "только аккорды" */
#chords-only-button.chords-only-active {
    background-color: var(--accent-color) !important;
    color: var(--button-text-color) !important;
    border-color: var(--accent-color) !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* --- Кнопка Копировать текст --- */
#copy-text-button {
    position: absolute;    /* АБСОЛЮТНОЕ позиционирование внутри контейнера */
    top: 8px;              /* Отступ сверху */
    right: 8px;            /* Отступ справа */
    z-index: 10;           /* Поверх содержимого песни */
    width: 28px;           /* Компактный размер */
    height: 28px;
    font-size: 0.8rem;     /* Компактная иконка */
    /* Добавляем границу */
    background: var(--container-background-color) !important;
    border: 1px solid var(--border-color) !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
    opacity: 0.8;          /* Хорошо видимая */
    transition: opacity 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    display: none;         /* По умолчанию скрыта, пока не выбрана песня */
    transform: none;       /* Убираем transform */
}
#copy-text-button:hover {
    opacity: 1;            /* Полностью видимая при наведении */
}
/* Стиль для состояния "Скопировано" */
#copy-text-button.copied {
     background-color: var(--secondary-color) !important;
     border-color: var(--secondary-color) !important;
     color: var(--button-text-color) !important;
     opacity: 1;
}
body[data-theme="light"] #copy-text-button.copied {
     background-color: var(--secondary-color) !important;
     border-color: var(--secondary-color) !important;
     color: white !important;
}

/* --- SONG EDITOR STYLES --- */

/* Модальное окно редактора */
.song-editor-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(2px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 3000; /* Выше всех остальных элементов */
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.song-editor-overlay.visible {
    display: flex;
    opacity: 1;
    pointer-events: auto;
}

.song-editor-modal {
    background: var(--container-background-color);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 800px;
    height: 90%;
    max-height: 700px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

.song-editor-overlay.visible .song-editor-modal {
    transform: scale(1);
}

/* Заголовок редактора */
.song-editor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px 15px 25px;
    border-bottom: 1px solid var(--border-color);
    background: var(--container-background-color);
    flex-shrink: 0;
}

.song-editor-header h3 {
    margin: 0;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary-color);
}

#close-editor-button {
    width: 32px;
    height: 32px;
    font-size: 1rem;
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-color);
    border-radius: 50%;
    transition: all 0.2s ease;
}

#close-editor-button:hover {
    background: var(--hover-color);
    border-color: var(--primary-color);
    color: var(--primary-color);
}

/* Основной контент редактора */
.song-editor-content {
    flex: 1;
    padding: 20px 25px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.editor-info {
    margin-bottom: 15px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    flex-shrink: 0;
}

#edit-status-info {
    color: var(--label-color);
    flex: 1;
}

/* Textarea для редактирования */
.song-edit-textarea {
    flex: 1;
    width: 100%;
    min-height: 0; /* Убираем минимальную высоту */
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--background-color);
    color: var(--text-color);
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    font-size: 14px;
    line-height: 1.5;
    resize: none; /* Отключаем resize */
    box-sizing: border-box;
    
    /* Улучшенная прокрутка */
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;
    
    /* Поддержка свайпов на мобильных */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    
    /* Кастомный скроллбар */
    scrollbar-width: thin;
    scrollbar-color: var(--primary-color) var(--border-color);
}

/* Кастомный скроллбар для WebKit браузеров */
.song-edit-textarea::-webkit-scrollbar {
    width: 8px;
}

.song-edit-textarea::-webkit-scrollbar-track {
    background: var(--border-color);
    border-radius: 4px;
    margin: 2px 0;
}

.song-edit-textarea::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
    transition: background-color 0.2s ease;
}

.song-edit-textarea::-webkit-scrollbar-thumb:hover {
    background: color-mix(in srgb, var(--primary-color) 80%, black);
}

.song-edit-textarea:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 20%, transparent);
}

/* Футер с кнопками */
.song-editor-footer {
    padding: 20px 25px;
    border-top: 1px solid var(--border-color);
    background: var(--container-background-color);
    flex-shrink: 0;
}

.editor-controls {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.editor-button {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    font-weight: 500;
}

.editor-button:hover {
    transform: translateY(-1px);
}

.editor-button.save {
    background: var(--accent-color);
    color: white;
}

.editor-button.save:hover {
    background: color-mix(in srgb, var(--accent-color) 85%, black);
}

.editor-button.cancel {
    background: var(--border-color);
    color: var(--text-color);
}

.editor-button.cancel:hover {
    background: color-mix(in srgb, var(--border-color) 80%, black);
}

.editor-button.revert {
    background: #e74c3c;
    color: white;
}

.editor-button.revert:hover {
    background: #c0392b;
}

/* Мобильные стили для редактора */
@media (max-width: 768px) {
    .song-controls {
        position: static;
        margin-bottom: 10px;
        justify-content: flex-end;
    }
    
    .song-edit-textarea {
        min-height: 300px;
        font-size: 16px; /* Предотвращает зум на iOS */
    }
    
    .editor-controls {
        flex-direction: column;
    }
    
    .editor-button {
        justify-content: center;
        padding: 12px 16px;
    }
}


/* Стили для маркеров структуры песни (Куплет, Припев и т.д.) */
.song-structure {
    display: block; /* Занимает всю строку */
    font-weight: bold; /* Жирный шрифт */
    color: var(--secondary-color); /* Или var(--primary-color) */
    margin-top: 0.8em; /* Отступ сверху перед маркером */
    margin-bottom: 0.3em; /* Небольшой отступ снизу после маркера */
    text-transform: uppercase; /* Можно сделать большими буквами */
    letter-spacing: 0.5px; /* Небольшое разрежение букв */
    font-size: 0.9em; /* Чуть меньше основного текста, если нужно */
}
/* Убираем лишний отступ у самого первого маркера в тексте */
pre > .song-structure:first-child {
    margin-top: 0;
}

/* В режиме презентации можно сделать их чуть заметнее */
.presentation-song .song-structure {
     color: var(--primary-color); /* Другой цвет в презентации */
     font-size: 0.85em;
     margin-top: 1em;
     margin-bottom: 0.4em;
}
body[data-theme="light"] .presentation-song .song-structure {
     color: var(--secondary-color); /* Цвет для светлой темы в презентации */
}

/* === СТИЛИ ДЛЯ БЛОКОВ ПЕСНИ === */
/* ПОЛНЫЙ СБРОС всех браузерных стилей для fieldset */
.song-block {
    /* СБРОС браузерных стилей fieldset */
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    margin: 2px 0 !important; /* Минимальный отступ между блоками */
    padding: 0 !important; /* ПОЛНОСТЬЮ убираем padding у fieldset */
    background-color: var(--container-background-color);
    transition: border-color 0.3s ease, background-color 0.3s ease;
    
    /* Убираем все браузерные отступы */
    min-width: 0;
    max-width: 100%; /* Строго ограничиваем ширину */
    box-sizing: border-box;
    
    /* Принудительный перенос текста */
    word-wrap: break-word;
    overflow-wrap: break-word;
    overflow: hidden; /* Запрещаем выход за пределы */
}

.song-block:first-child {
    margin-top: 0 !important;
}

.song-block:last-child {
    margin-bottom: 0 !important;
}

/* КАРДИНАЛЬНО ПЕРЕРАБОТАННЫЕ стили для legend */
.song-block-legend {
    color: var(--primary-color);
    font-weight: 700; /* Увеличили жирность с 600 до 700 для лучшего выделения */
    font-size: calc(var(--lyrics-font-size, 1rem) * 1.0); /* Такой же размер как основной текст */
    text-transform: uppercase;
    letter-spacing: 0.2px;
    transition: color 0.3s ease, background-color 0.3s ease;
    
    /* ДОБАВЛЯЕМ ФОН КАК У АККОРДОВ */
    background-color: color-mix(in srgb, var(--accent-color) 2%, transparent);
    border-radius: 3px;
    
    /* МАКСИМАЛЬНО КОМПАКТНЫЕ отступы */
    padding: 4px 8px !important; /* Увеличили вертикальный padding еще больше для лучшего центрирования */
    margin: 0 0 -16px 12px !important; /* Увеличили отрицательный margin с -10px до -16px для максимальной компактности */
    border: none !important;
    line-height: 1.3 !important; /* Увеличили line-height для еще лучшего вертикального выравнивания */
    
    /* Защита от переполнения */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: calc(100% - 24px);
    
    /* Позиционирование и центрирование */
    float: none !important;
    width: auto !important;
    display: inline-flex !important; /* Изменили на inline-flex для лучшего центрирования */
    align-items: center !important; /* ЦЕНТРИРУЕМ текст по вертикали внутри фона */
}

.song-block-content {
    margin: -14px 0 0 0 !important; /* Увеличили отрицательный margin с -8px до -14px для максимальной компактности */
    padding: 0px 6px 1px 6px !important; /* Сократили нижний padding еще в 2 раза: с 2px до 1px */
    white-space: pre-wrap; /* Изменяем с pre на pre-wrap для переноса */
    line-height: inherit;
    box-sizing: border-box;
    max-width: 100%; /* Строго ограничиваем ширину */
    
    /* Принудительный перенос текста */
    word-wrap: break-word;
    overflow-wrap: break-word;
    overflow: hidden; /* Запрещаем выход за пределы */
}

/* Светлая тема для блоков */
body[data-theme="light"] .song-block {
    border-color: var(--border-color);
    background-color: var(--container-background-color);
}

body[data-theme="light"] .song-block-legend {
    color: var(--secondary-color);
    background-color: color-mix(in srgb, var(--accent-color) 5%, transparent); /* Более заметный фон в светлой теме как у аккордов */
}

/* === ИНТЕЛЛЕКТУАЛЬНЫЙ ПАРСЕР: СТИЛИ УВЕРЕННОСТИ === */

/* Высокая уверенность распознавания (80%+) */
.song-block.high-confidence {
    border-color: color-mix(in srgb, var(--accent-color) 60%, transparent);
}

.song-block.high-confidence .song-block-legend {
    border-color: color-mix(in srgb, var(--accent-color) 80%, transparent);
    background: color-mix(in srgb, var(--accent-color) 8%, transparent);
}

body[data-theme="light"] .song-block.high-confidence .song-block-legend {
    background: color-mix(in srgb, var(--accent-color) 12%, transparent);
    border-color: color-mix(in srgb, var(--accent-color) 40%, transparent);
}

/* Средняя уверенность распознавания (50-80%) */
.song-block.medium-confidence {
    border-color: color-mix(in srgb, #fbbf24 40%, transparent);
}

.song-block.medium-confidence .song-block-legend {
    border-color: color-mix(in srgb, #fbbf24 60%, transparent);
    background: color-mix(in srgb, #fbbf24 5%, transparent);
}

body[data-theme="light"] .song-block.medium-confidence .song-block-legend {
    background: color-mix(in srgb, #fbbf24 8%, transparent);
    border-color: color-mix(in srgb, #fbbf24 30%, transparent);
}

/* Низкая уверенность распознавания (<50%) */
.song-block.low-confidence {
    border-color: color-mix(in srgb, var(--danger-color) 30%, transparent);
}

.song-block.low-confidence .song-block-legend {
    border-color: color-mix(in srgb, var(--danger-color) 50%, transparent);
    background: color-mix(in srgb, var(--danger-color) 3%, transparent);
}

body[data-theme="light"] .song-block.low-confidence .song-block-legend {
    background: color-mix(in srgb, var(--danger-color) 5%, transparent);
    border-color: color-mix(in srgb, var(--danger-color) 25%, transparent);
}

/* Анимация для новых блоков */
.song-block[data-method="learned"] {
    animation: learnedBlock 0.5s ease-out;
}

@keyframes learnedBlock {
    0% {
        border-color: var(--accent-color);
        box-shadow: 0 0 15px color-mix(in srgb, var(--accent-color) 30%, transparent);
    }
    100% {
        border-color: color-mix(in srgb, var(--accent-color) 60%, transparent);
        box-shadow: none;
    }
}

/* Дополнительные визуальные подсказки */
.song-block[data-type="verse"] .song-block-legend::before {
    content: "📝 ";
    opacity: 0.7;
}

.song-block[data-type="chorus"] .song-block-legend::before {
    content: "🎵 ";
    opacity: 0.7;
}

.song-block[data-type="bridge"] .song-block-legend::before {
    content: "🌉 ";
    opacity: 0.7;
}

.song-block[data-type="intro"] .song-block-legend::before {
    content: "🎬 ";
    opacity: 0.7;
}

.song-block[data-type="outro"] .song-block-legend::before {
    content: "🎭 ";
    opacity: 0.7;
}

.song-block[data-type="solo"] .song-block-legend::before {
    content: "🎸 ";
    opacity: 0.7;
}

.song-block[data-type="pre"] .song-block-legend::before {
    content: "🔀 ";
    opacity: 0.7;
}

/* Подсказка при наведении на блок */
.song-block[data-confidence][data-method] .song-block-legend:hover::after {
    content: "Уверенность: " attr(data-confidence) "% (" attr(data-method) ")";
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    white-space: nowrap;
    z-index: 1000;
    pointer-events: none;
}

body[data-theme="light"] .song-block[data-confidence][data-method] .song-block-legend:hover::after {
    background: rgba(0, 0, 0, 0.8);
}




/* === ВАРИАНТ 4: Минималистичный (Ghost Buttons) === */
/* Добавить/Изменить в styles.css */

.repertoire-view-controls {
    display: flex;
    justify-content: flex-start; /* Кнопки не растягиваются */
    gap: 8px; /* Зазор между кнопками */
    margin-bottom: 15px;
    /* Убираем стили контейнера группы */
    border: none;
    border-radius: 0;
    overflow: visible;
    padding: 0;
    background-color: transparent;
}

.repertoire-view-button {
    flex-grow: 0; /* Не растягивать */
    padding: 6px 12px; /* Побольше горизонтальные отступы */
    font-size: 0.8rem;
    text-align: center;
    background-color: transparent;
    color: var(--label-color);
    border: 1px solid var(--border-color); /* Рамка у неактивных */
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    border-radius: var(--radius); /* Обычное скругление */
    box-shadow: none !important;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    line-height: 1.2;
}

.repertoire-view-button:hover:not(.active) {
    border-color: var(--text-color); /* Рамка темнее при наведении */
    color: var(--text-color);
}

/* Стиль АКТИВНОЙ кнопки */
.repertoire-view-button.active {
    background-color: var(--primary-color);
    color: var(--button-text-color) !important;
    border-color: var(--primary-color); /* Рамка в цвет фона */
    font-weight: 500;
}

/* Стили для светлой темы */
body[data-theme="light"] .repertoire-view-button {
     color: var(--label-color);
     border-color: var(--border-color);
}
body[data-theme="light"] .repertoire-view-button:hover:not(.active) {
     border-color: var(--text-color);
     color: var(--text-color);
}
body[data-theme="light"] .repertoire-view-button.active {
     background-color: var(--primary-color);
     color: var(--button-text-color) !important;
     border-color: var(--primary-color);
}


/* Адаптивность */
@media (max-width: 380px) {
    /* .repertoire-view-controls и .repertoire-view-button .button-text-rp используют базовые стили */
    .repertoire-view-button {
         /* Настройки для мобильных */
          padding: 6px 8px; /* Уменьшить паддинг */
    }
    
    /* Принудительно горизонтальное расположение на очень маленьких экранах */
    .select-filters-container { 
        flex-direction: row !important; 
        flex-wrap: nowrap !important;
        gap: 4px !important; /* Увеличили с 2px до 4px для очень маленьких экранов */
        margin-bottom: 0px !important; /* МАКСИМАЛЬНОЕ сближение: убираем margin-bottom полностью на очень маленьких экранах */
    }
    
    /* Компактный fieldset поиска на маленьких экранах */
    .search-group {
        padding: 2px 4px 5px 4px; /* Возвращаем исходные отступы */
        margin-bottom: -2px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с фильтрами на очень маленьких экранах */
    }
    
    .search-group legend {
        font-size: 0.7rem; /* Уменьшили размер для очень маленьких экранов */
        padding: 0 8px; /* Уменьшили отступы */
    }
    
    .filter-group { 
        flex: 1; 
        min-width: 0;
        height: 36px; /* Такая же высота как input на очень маленьких экранах */
        padding: 3px 4px; /* Упрощенный padding как у input */
        display: flex;
        align-items: center; /* Возвращаем центрирование */
    }
    
    .select-filters-container .filter-group select {
        width: 100%;
        height: 100%; /* Заполняем всю высоту на очень маленьких экранах */
        padding: 0 2px;
        padding-right: 12px;
        font-size: 0.85rem; /* Увеличили размер текста для очень маленьких экранов */
    }

    
    /* ЭКСТРА-СТРОГИЕ ограничения для очень маленьких экранов */
    /* Разделение функциональных кнопок на очень маленьких экранах */
    .control-group:has(#key-select) { 
        margin-top: 15px; /* УМЕРЕННОЕ разделение на очень маленьких экранах */
        margin-bottom: -2px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с областью песни на очень маленьких экранах */
        padding-top: 8px; /* Небольшой отступ сверху */
    }
    
    /* Область песни на очень маленьких экранах */
    #song-content { 
        margin-top: 0px; /* МАКСИМАЛЬНОЕ сближение: убираем margin-top полностью на очень маленьких экранах */
    }
    
    .side-panel { 
        width: 260px !important; 
        max-width: 80vw !important;
        min-width: 220px !important;
        padding: 8px !important;
    }
}

/* КРИТИЧЕСКИЕ ограничения для ОЧЕНЬ маленьких экранов */
@media (max-width: 320px) {
    /* Дополнительные ограничения для очень маленьких экранов */
    *:not(.side-panel):not(.modal-overlay):not(.modal-content):not(.presentation-overlay):not(button):not(.mobile-nav-button) {
        background-attachment: scroll !important;
        background-image: none !important;
        backdrop-filter: none !important;
        filter: none !important;
    }
    
    /* Сохраняем двухслойную структуру для визуального разделения */
    html, body {
        background: var(--background-color) !important;
        background-image: none !important;
    }
    
    .container {
        background: var(--container-background-color) !important;
        background-image: none !important;
    }
    
    html[data-theme="light"], 
    body[data-theme="light"] {
        background: var(--background-color) !important;
        background-image: none !important;
    }
    
    body[data-theme="light"] .container {
        background: var(--container-background-color) !important;
        background-image: none !important;
    }
    
    .side-panel { 
        width: 240px !important; 
        max-width: 75vw !important;
        min-width: 200px !important;
        padding: 6px !important;
        font-size: 0.8rem !important;
    }
    
    .list-container {
        padding: 3px !important;
    }
    
    .favorite-item, .setlist-item, .setlist-song-item, .repertoire-item { 
        font-size: 0.75rem !important; 
        padding: 6px 8px !important; 
    }
    
    /* УЛЬТРА-КОМПАКТНЫЕ блоки песни для очень маленьких экранов */
    .song-block {
        margin: 0px 0 !important; /* УЛЬТРА сокращение: убираем margin полностью */
        border-radius: 2px !important; /* Минимальные скругления */
    }
    
    .song-block-legend {
        font-size: 0.7rem !important; /* УЛЬТРА сокращение: с 0.75rem до 0.7rem */
        font-weight: 700 !important; /* Более жирный шрифт для выделения */
        padding: 3px 4px !important; /* Увеличили padding еще больше для лучшего центрирования */
        margin: 0 0 -25px 6px !important; /* ЭКСТРЕМАЛЬНЫЙ отрицательный margin для мини-экранов */
        letter-spacing: 0px !important; /* УЛЬТРА сокращение: убираем letter-spacing */
        line-height: 1.2 !important; /* Увеличили line-height для еще лучшего вертикального выравнивания */
        
        /* Центрирование для мини-экранов */
        display: inline-flex !important;
        align-items: center !important; /* Только вертикальное центрирование внутри фона */
    }
    
    .song-block-content {
        margin: -20px 0 0 0 !important; /* ЭКСТРЕМАЛЬНЫЙ отрицательный margin - МАКСИМАЛЬНОЕ сближение! */
        padding: 0px 3px 0px 3px !important; /* Убрали нижний padding полностью (с 1px до 0px) */
    }
}
/* === КОНЕЦ ВАРИАНТА 4 === */

/* ============================================ */
/* АДАПТИВНОСТЬ                                */
/* ============================================ */

/* Универсальные стили для планшетов и мобильных */
@media (max-width: 1024px) { 
    /* ================================================================ */
    /* === ФИНАЛЬНЫЙ ФИКС: Жесткое ограничение viewport === */
    /* ================================================================ */
    html, body {
        /* 1. Жестко задаем ширину и убираем все отступы */
        width: 100%;
        max-width: 100vw; /* Дополнительное ограничение */
        margin: 0;
        padding: 0;

        /* 2. ГЛАВНОЕ: Принудительно обрезаем всё, что выходит за рамки */
        overflow-x: hidden !important;

        /* 3. На всякий случай убираем любые фоновые изображения */
        background-image: none !important;
        
        /* 4. Явно задаем сплошной цвет фона */
        background-color: var(--background-color) !important;
        
        /* 5. Убираем 'fixed', чтобы избежать связанных с ним багов */
        background-attachment: scroll !important; 
    }
    
    /* Убираем фоновые эффекты только с элементов, которые могут создавать градиенты */
    *:not(.side-panel):not(.modal-overlay):not(.modal-content):not(.presentation-overlay):not(button):not(.mobile-nav-button) {
        background-attachment: scroll !important;
        background-image: none !important;
        backdrop-filter: none !important;
        filter: none !important;
    }
    
    /* Сохраняем двухслойную структуру контейнера */
    .container {
        background: var(--container-background-color) !important;
        background-image: none !important;
    }
    
    /* Для светлой темы */
    html[data-theme="light"], 
    body[data-theme="light"] {
        background: var(--background-color) !important;
        background-image: none !important;
    }
    
    body[data-theme="light"] .container {
        background: var(--container-background-color) !important;
        background-image: none !important;
    }
    
    .select-filters-container { 
        flex-direction: row !important; 
        gap: 10px !important; /* Увеличили с 8px до 10px для планшетов */
        flex-wrap: nowrap !important;
        margin-bottom: 0px !important; /* МАКСИМАЛЬНОЕ сближение: убираем margin-bottom полностью на планшетах */
    }
    .filter-group { 
        flex: 1; 
        min-width: 0;
        height: 38px; /* ИСПРАВЛЯЕМ: делаем такую же высоту как строка поиска на планшетах */
        padding: 8px 12px; /* Упрощенный padding как у input */
        display: flex;
        align-items: center; /* Возвращаем центрирование */
    }
    .select-filters-container .filter-group select {
        width: 100%;
        height: 100%; /* Заполняем всю высоту на планшетах */
        padding: 0 4px;
        padding-right: 16px;
        font-size: 1rem; /* Увеличили размер текста для планшетов */
    }
    
    /* Поисковая группа на планшетах */
    .search-group {
        margin-bottom: -2px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с фильтрами на планшетах */
    }
    
    /* Разделение функциональных кнопок на планшетах */
    .control-group:has(#key-select) { 
        margin-top: 20px; /* УМЕРЕННОЕ разделение на планшетах */
        margin-bottom: -2px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с областью песни на планшетах */
        padding-top: 12px; /* Небольшой отступ сверху */
    }
    
    /* Область песни на планшетах */
    #song-content { 
        margin-top: 0px; /* МАКСИМАЛЬНОЕ сближение: убираем margin-top полностью на планшетах */
    }

}

@media (max-width: 480px) {
    /* СТРОГИЕ ОГРАНИЧЕНИЯ для предотвращения выхода за пределы экрана */
    html, body { 
        max-width: 100vw !important; 
        overflow-x: hidden !important; 
        position: relative !important;
    }
    * { 
        max-width: 100% !important; 
        box-sizing: border-box !important; 
    }

    /* ================================================================ */
    /* === УСИЛЕННЫЙ ФИКС для мобильных: Жесткое ограничение viewport === */
    /* ================================================================ */
    html, body {
        /* 1. Жестко задаем ширину и убираем все отступы */
        width: 100%;
        max-width: 100vw; /* Дополнительное ограничение */
        margin: 0;
        padding: 0;

        /* 2. ГЛАВНОЕ: Принудительно обрезаем всё, что выходит за рамки */
        overflow-x: hidden !important;

        /* 3. На всякий случай убираем любые фоновые изображения */
        background-image: none !important;
        
        /* 4. Явно задаем сплошной цвет фона */
        background-color: var(--background-color) !important;
        
        /* 5. Убираем 'fixed', чтобы избежать связанных с ним багов */
        background-attachment: scroll !important; 
    }
    
    /* Убрали маскировку - она не сработала */
    
    /* ДОПОЛНИТЕЛЬНЫЕ ОГРАНИЧЕНИЯ для мобильных - убираем фоновые эффекты */
    *:not(.side-panel):not(.modal-overlay):not(.modal-content):not(.presentation-overlay):not(button):not(.mobile-nav-button) {
        background-attachment: scroll !important;
        background-image: none !important;
        backdrop-filter: none !important;
        filter: none !important;
    }
    
    /* Двухслойная структура уже задана выше */
    
    .container {
        background: var(--container-background-color) !important;
        background-image: none !important;
    }
    
    /* Светлая тема уже обрабатывается выше */
    
    body[data-theme="light"] .container {
        background: var(--container-background-color) !important;
        background-image: none !important;
    }
    
    /* ПРИНУДИТЕЛЬНОЕ ОГРАНИЧЕНИЕ для всех fixed элементов */
    *[style*="position: fixed"], 
    .side-panel, 
    #setlists-panel, 
    #my-list-panel, 
    #repertoire-panel {
        max-width: 90vw !important;
        width: 90vw !important;
        left: 0 !important;
        right: auto !important;
        margin: 0 !important;
        border: none !important;
        transform: translateX(-100%) !important;
    }
    
    .side-panel.open,
    #setlists-panel.open, 
    #my-list-panel.open, 
    #repertoire-panel.open {
        transform: translateX(0) !important;
        max-width: 90vw !important;
        width: 90vw !important;
    }
    
    /* МАКСИМАЛЬНАЯ ОПТИМИЗАЦИЯ ОТСТУПОВ ДЛЯ ТЕКСТА */
    body { 
        padding: 1px; font-size: 14px; padding-bottom: 70px; /* Уменьшили с 2px до 1px */
    }
    .container { 
        padding: 3px; margin: 1px auto; /* Уменьшили с 6px/2px до 3px/1px */
    }
    header { padding: 4px 6px; margin-bottom: 4px; } /* Уменьшили с 5px 8px до 4px 6px */
    h1 { font-size: 1.2rem; }
    .controls { gap: 8px; margin-bottom: 8px; } /* Уменьшили с 10px до 8px */
    
    /* Мобильные стили для fieldset поиска */
    .search-group {
        padding: 2px 3px 5px 3px; /* Возвращаем исходные отступы */
        margin-bottom: -2px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с фильтрами на мобильных */
    }
    
    .search-group legend {
        font-size: 0.7rem; /* Размер для мобильных */
        padding: 0 8px; /* Отступы для мобильных */
    }
    
    .search-group #search-input {
        font-size: 14px;
        padding: 5px 6px; /* Уменьшили с 6px 8px */
        height: 36px;
    }
    #song-title {
        font-size: 0.9rem; /* Еще меньше для мобильных */
        padding: 0 6px; /* Уменьшили с 8px до 6px */
    }

    select, input { font-size: 14px; padding: 5px 6px; height: 36px; } /* Уменьшили с 6px 8px */
    select { padding-right: 24px; background-position: right 5px center; background-size: 12px; } /* Уменьшили отступы */
    button { font-size: 14px; }
    
    /* Адаптивность для select-filters-container - уточненные стили для мобильных */
    .select-filters-container { 
        flex-direction: row !important; 
        gap: 6px !important; /* Увеличили с 2px до 6px для мобильных */
        margin-bottom: 0px !important; /* МАКСИМАЛЬНОЕ сближение: убираем margin-bottom полностью на мобильных */
    }
    .filter-group { 
        min-width: 0; 
        flex: 1; 
        height: 36px; /* ИСПРАВЛЯЕМ: правильная высота для мобильных */
        padding: 5px 6px; /* Упрощенный padding как у input на мобильных */
        display: flex;
        align-items: center; /* Возвращаем центрирование */
    }
    .select-filters-container .filter-group select { 
        width: 100%;
        height: 100%; /* Заполняем всю высоту на мобильных */
        padding: 0 2px; /* Уменьшили с 3px */
        padding-right: 12px; /* Уменьшили с 14px */
        font-size: 0.9rem; /* Увеличили размер текста для мобильных */
    }
    #theme-toggle-button { right: 8px; } /* Уменьшили с 10px */

    /* Ряд Тональность/Разделить/Масштаб */
    .control-group:has(#key-select) { 
        min-height: 36px; 
        gap: 6px; 
        margin-bottom: -2px; /* ОТРИЦАТЕЛЬНЫЙ margin для сближения с областью песни на мобильных */
        margin-top: 18px; /* УМЕРЕННОЕ разделение на мобильных */
        padding-top: 10px; /* Небольшой отступ сверху */
    }
    
    /* Мобильный fieldset для тональности */
    .key-group {
        height: 36px;
        padding: 2px 3px 6px 3px; /* Уменьшили с 2px 4px 7px 4px */
    }
    .key-group legend {
        display: none; /* Скрываем legend на мобильных */
    }
    #key-select { width: 100%; min-width: 55px; height: 19px; padding: 0 12px 0 12px; background-position: right 2px center; background-size: 12px; text-align: center; box-sizing: border-box; } /* Уменьшили padding с 15px до 12px */
    
    /* Мобильная группировка кнопок */
    .function-buttons-group {
        padding: 0 3px; /* Уменьшили с 4px */
        margin: 0 2px; /* Уменьшили с 3px */
        gap: 2px; /* Уменьшили с 3px */
        border-left: 1px solid color-mix(in srgb, var(--border-color) 40%, transparent);
        border-right: 1px solid color-mix(in srgb, var(--border-color) 40%, transparent);
    }
    /* Кнопка Разделить на мобильных */
    #split-text-button { width: 36px; height: 36px; padding: 0; margin: 0; display: inline-flex; align-items: center; justify-content: center; }
    
    #split-text-button > i { font-size: 0.9rem; margin: 0; }
    #split-text-button .button-text { display: none; }

    #zoom-in, #zoom-out { width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; }
    #zoom-in > i, #zoom-out > i { margin: 0; }

    /* --- Мобильные стили для новых кнопок --- */
    #toggle-chords-button {
        width: 36px; /* Фиксированная ширина как у других иконок */
        height: 36px;
        padding: 0;
        margin: 0;
        order: 0; /* Возвращаем стандартный порядок на мобильных, если нужно */
    }
    #toggle-chords-button .button-text {
        display: none; /* Скрываем текст */
    }
     #toggle-chords-button i {
        margin-right: 0; /* Убираем отступ иконки */
        font-size: 1rem; /* Синхронизируем размер с десктопом */
        position: relative;
    }
    
    /* Перечеркивание кнопки скрытия аккордов на мобильных */
    #toggle-chords-button::after {
        content: '';
        position: absolute;
        top: 25%; /* Синхронизируем с десктопом */
        left: 10%; /* Синхронизируем с десктопом */
        width: 80%; /* Синхронизируем с десктопом */
        height: 50%; /* Синхронизируем с десктопом */
        background: linear-gradient(to top right, transparent 48.5%, currentColor 48.5%, currentColor 51.5%, transparent 51.5%);
        z-index: 1;
        pointer-events: none;
    }
    
    /* Активное состояние кнопки на мобильных */
    #toggle-chords-button.chords-hidden-active {
        background-color: var(--primary-color) !important;
        color: var(--button-text-color) !important;
        border-color: var(--primary-color) !important;
    }
    
    /* Кнопка "только аккорды" на мобильных */
    #chords-only-button {
        width: 36px; /* Фиксированная ширина как у других иконок */
        height: 36px;
        padding: 0;
        margin: 0;
        margin-left: 3px; /* Небольшой отступ от предыдущей кнопки */
    }
    #chords-only-button .button-text {
        display: none; /* Скрываем текст */
    }
    #chords-only-button .text-icon {
        margin-right: 0; /* Убираем отступ иконки */
        font-size: 1rem; /* Синхронизируем размер с десктопом */
        font-weight: 700; /* Синхронизируем вес с десктопом */
        position: relative;
    }
    
    /* Перечеркивание кнопки "только аккорды" на мобильных */
    #chords-only-button::after {
        content: '';
        position: absolute;
        top: 25%; /* Синхронизируем с десктопом и кнопкой скрытия аккордов */
        left: 10%; /* Синхронизируем с десктопом и кнопкой скрытия аккордов */
        width: 80%; /* Синхронизируем с десктопом и кнопкой скрытия аккордов */
        height: 50%; /* Синхронизируем с десктопом и кнопкой скрытия аккордов */
        background: linear-gradient(to top right, transparent 48.5%, currentColor 48.5%, currentColor 51.5%, transparent 51.5%);
        z-index: 1;
        pointer-events: none;
    }
    
    /* Активное состояние кнопки "только аккорды" на мобильных */
    #chords-only-button.chords-only-active {
        background-color: var(--accent-color) !important;
        color: var(--button-text-color) !important;
        border-color: var(--accent-color) !important;
    }
         /* Кнопка Копировать на мобильных */
     #copy-text-button {
         /* Абсолютное позиционирование внутри контейнера песни */
         width: 26px;    /* Еще компактнее на мобильных */
         height: 26px;
         font-size: 0.75rem;
         opacity: 0.9;   /* Максимально видимая на мобильных */
         /* Добавляем границу на мобильных */
         background: var(--container-background-color) !important;
         border: 1px solid var(--border-color) !important;
         box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
     }
     /* --- Конец мобильных стилей для новых кнопок --- */


    /* Footer */
    .controls-footer { align-items: stretch; flex-direction: column; gap: 8px; margin-top: 12px; } /* Уменьшили gap с 10px до 8px, margin с 15px до 12px */
    .controls-footer > * { width: auto; margin-bottom: 6px; align-self: center; } /* Уменьшили с 8px */
    .controls-footer .bpm-controls { justify-content: center; width: 100%; }
    .bpm-controls #time-signature, .bpm-controls #bpm-display { height: 36px; }
    #metronome-button { width: 42px; height: 42px; padding: 0; margin: 4px auto; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; } /* Уменьшили margin с 5px */
    #metronome-button > i { font-size: 1.1rem; margin: 0; }
    #metronome-button .button-text { display: none; }
    #holychords-button { padding: 6px 12px; height: 36px; } /* Уменьшили padding с 8px 15px */
    #add-to-repertoire-button { padding: 8px 12px; height: 40px; } /* Уменьшили padding с 10px 15px */

    /* ===== САМАЯ ВАЖНАЯ ЧАСТЬ - ОБЛАСТЬ ТЕКСТА ===== */
    #song-content { 
        /* МОБИЛЬНЫЕ ОТСТУПЫ */
        padding: 4px 6px 8px 6px; /* КАРДИНАЛЬНО уменьшили с 8px 10px 12px 10px */
        margin-top: 0px; /* МАКСИМАЛЬНОЕ сближение: убираем margin-top полностью на мобильных */
        
        /* ВСЕ ОСТАЛЬНЫЕ СВОЙСТВА ОБЯЗАТЕЛЬНО НАСЛЕДУЕМ */
        background: var(--container-background-color); 
        border-radius: var(--radius); 
        box-shadow: none; 
        position: relative; 
        overflow: hidden; 
        border: 1px solid var(--border-color); 
        transition: background-color 0.3s ease, border-color 0.3s ease;
        margin-left: 0;
        margin-right: 0;
    }
    #song-content pre {
        /* МОБИЛЬНЫЕ ОТСТУПЫ И РАЗМЕРЫ */
        font-size: var(--lyrics-font-size); /* ИСПОЛЬЗУЕМ ПЕРЕМЕННУЮ */
        line-height: 1.3; /* Стандартизируем с основным текстом */
        padding-top: 2px; /* МИНИМАЛЬНЫЙ отступ с 6px 0 */
        
        /* ВСЕ ОСТАЛЬНЫЕ СВОЙСТВА С ТОЧНЫМ ПОЗИЦИОНИРОВАНИЕМ */
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; /* ВОЗВРАЩАЕМ исходный шрифт */
        white-space: pre; /* PRE ДЛЯ ТОЧНОГО ПОЗИЦИОНИРОВАНИЯ */
        word-wrap: normal; /* ОТКЛЮЧАЕМ WORD-WRAP */
        color: var(--text-color); 
        margin: 0; 
        overflow-x: auto; 
        transition: color 0.3s ease;
        letter-spacing: 0; /* УБИРАЕМ LETTER-SPACING */
        word-spacing: 0; /* УБИРАЕМ WORD-SPACING */
        tab-size: 1; /* КРИТИЧНО: размер табуляции */
        -moz-tab-size: 1; /* для Firefox */
        font-variant-numeric: tabular-nums; /* моноширинные цифры */
    }
    /* ===== КОНЕЦ САМОЙ ВАЖНОЙ ЧАСТИ ===== */

    /* МОБИЛЬНЫЕ ПАНЕЛИ - КРИТИЧЕСКАЯ ПЕРЕПИСКА */
    .side-panel { 
        /* РАЗМЕРЫ - СТРОГО ОГРАНИЧЕННЫЕ */
        width: 280px !important;
        max-width: 85vw !important;
        min-width: 250px !important;
        
        /* ПОЗИЦИОНИРОВАНИЕ - АБСОЛЮТНОЕ */
        position: fixed !important;
        top: 0 !important;
        bottom: 0 !important;
        height: 100vh !important;
        
        /* ОТСТУПЫ И ПЕРЕПОЛНЕНИЕ */
        padding: 12px !important;
        gap: 8px !important;
        overflow: hidden !important;
        box-sizing: border-box !important;
        
        /* ОБЩИЕ СТИЛИ */
        z-index: 1000 !important;
        background-color: var(--container-background-color) !important;
        border: 1px solid var(--border-color) !important;
    }
    
    /* ВСЕ ПАНЕЛИ НА МОБИЛЬНЫХ ВЫЕЗЖАЮТ СЛЕВА, КРОМЕ РЕПЕРТУАРА */
    #setlists-panel,
    #my-list-panel {
        left: 0 !important;
        right: auto !important;
        transform: translateX(-100%) !important;
        border-right: 2px solid var(--primary-color) !important;
        border-left: none !important;
    }
    
    /* ПАНЕЛЬ РЕПЕРТУАРА ВЫЕЗЖАЕТ СПРАВА НА МОБИЛЬНЫХ */
    #repertoire-panel {
        right: 0 !important;
        left: auto !important;
        transform: translateX(100%) !important;
        border-left: 2px solid var(--primary-color) !important;
        border-right: none !important;
    }
    
    #setlists-panel.open,
    #my-list-panel.open {
        transform: translateX(0) !important;
    }
    
    #repertoire-panel.open {
        transform: translateX(0) !important;
    }
    
    /* КНОПКИ ЗАКРЫТИЯ */
    .side-panel-close-btn {
        position: absolute !important;
        top: 8px !important;
        width: 28px !important;
        height: 28px !important;
        z-index: 10 !important;
    }
    
    /* Кнопки закрытия для левых панелей (справа) */
    #setlists-panel .side-panel-close-btn,
    #my-list-panel .side-panel-close-btn {
        right: 8px !important;
        left: auto !important;
    }
    
    /* Кнопка закрытия для правой панели (слева) */
    #repertoire-panel .side-panel-close-btn {
        left: 8px !important;
        right: auto !important;
    }
    
    .list-container { 
        max-height: none; /* Убираем ограничение высоты на мобильных */
        overflow-x: hidden; /* Запрещаем горизонтальную прокрутку */
        word-wrap: break-word; /* Переносим слова */
        word-break: break-word; /* Принудительно разбиваем слова */
    }
    .favorite-item, .setlist-item, .setlist-song-item { 
        font-size: 0.85rem; padding: 8px 10px; 
        overflow: hidden; /* Строго запрещаем выход за пределы */
        word-wrap: break-word; /* Переносим слова */
        word-break: break-word; /* Принудительно разбиваем слова */
    }
    #repertoire-panel .panel-header { font-size: 1.1rem; padding-bottom: 8px; }
#repertoire-panel {
    padding-top: 8px;
}
    #repertoire-panel #vocalist-select { padding: 8px 12px; padding-right: 30px; font-size: 0.9rem; margin-bottom: 8px; height: 36px; box-sizing: border-box; }
    #repertoire-panel-list { padding: 5px; }
    #repertoire-panel .repertoire-item { font-size: 0.85rem; padding: 7px 8px 7px 15px; }
    /* Форма создания сет-листа */
 #repertoire-panel {
        padding-top: 5px;
        padding-left: 10px;
        padding-right: 10px;
    }
     #repertoire-panel .panel-header {
          font-size: 1rem; /* Уменьшаем заголовок на мобильных */
          margin-bottom: 5px;
          padding-bottom: 4px;
     }

    #setlists-panel .create-setlist-form { margin-bottom: 10px; }
    #new-setlist-name-input { font-size: 0.9rem; padding: 7px 10px; height: 36px; box-sizing: border-box; }
    #create-setlist-button { padding: 7px 12px; font-size: 0.8rem; }
    /* Контролы текущего сет-листа на мобильных */
    #setlists-panel .current-setlist-controls {
        margin-bottom: 8px;
        /* padding-bottom: 8px; */ /* Убедитесь, что это закомментировано или удалено, если не нужно */
        gap: 8px; /* Можно уменьшить отступ на мобильных */
    }
    #setlists-panel .current-setlist-controls button {
        font-size: 0.75em !important; /* Уменьшаем шрифт еще */
        padding: 6px 10px !important; /* Уменьшаем паддинги */
        max-width: calc(50% - 4px); /* Пересчитываем макс. ширину под новый gap */
    }


    /* --- Презентация на МОБИЛЬНЫХ --- */
    .presentation-content {
        padding: 15px 10px 65px 10px;
    }
    .presentation-song h2 {
         font-size: 0.9rem !important;
         margin-bottom: 4px !important;
         line-height: 1.2 !important;
         font-weight: 500 !important;
    }
    .presentation-notes {
        font-size: 0.7em !important;
        margin-bottom: 8px !important;
        padding: 2px 5px !important;
        line-height: 1.25 !important;
    }
     .presentation-notes i.fas {
        font-size: 0.9em !important;
        margin-right: 3px !important;
    }
    .presentation-song pre {
         font-size: clamp(11px, 2.8vw, 15px) !important;
         line-height: 1.3 !important; /* Стандартизируем со всеми остальными */
         margin-top: 0 !important;
    }
    /* --- Конец стилей презентации на мобильных --- */

    .presentation-close-btn { width: 36px; height: 36px; font-size: 1.3rem; }
    .presentation-control-btn { width: 36px; height: 36px; font-size: 0.9rem; }
    #pres-split-text-btn { right: 58px; }
    .presentation-controls { padding: 6px 10px; }
    .presentation-nav-btn { font-size: 1.5rem; padding: 4px 10px; }
    .presentation-counter { font-size: 0.8rem; }
    /* #presentation-content.split-columns .presentation-song pre { column-gap: 25px; } */

    /* Модальное окно на мобильных */
    .modal-content { padding: 20px; width: 90%; }
    .modal-title { font-size: 1.1rem; }
    
    /* МОБИЛЬНЫЕ блоки песни - ЭКСТРА компактные */
    .song-block {
        margin: 1px 0 !important; /* Минимальный отступ между блоками */
    }
    
    .song-block-legend {
        font-size: calc(var(--lyrics-font-size, 1rem) * 0.95) !important; /* Почти как основной текст */
        font-weight: 700 !important; /* Более жирный шрифт для выделения */
        padding: 4px 6px !important; /* Увеличили вертикальный padding еще больше для лучшего центрирования */
        margin: 0 0 -12px 8px !important; /* Увеличили отрицательный margin с -5px до -12px для компактности */
        letter-spacing: 0.1px !important; 
        line-height: 1.3 !important; /* Увеличили line-height для еще лучшего вертикального выравнивания */
        
        /* Фон как у аккордов */
        background-color: color-mix(in srgb, var(--accent-color) 2%, transparent) !important;
        border-radius: 3px !important;
        
        /* Защита от переполнения */
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        max-width: calc(100% - 16px) !important;
        
        /* Позиционирование и центрирование */
        display: inline-flex !important; /* Изменили на inline-flex для лучшего центрирования */
        align-items: center !important; /* ЦЕНТРИРУЕМ текст по вертикали внутри фона */
    }
    
    .song-block-content {
        margin: -10px 0 0 0 !important; /* Увеличили отрицательный margin с -3px до -10px для компактности */
        padding: 0px 4px 0px 4px !important; /* Убрали нижний padding полностью: с 1px до 0px */
    }
    
    /* Фон для светлой темы на мобильных */
    body[data-theme="light"] .song-block-legend {
        background-color: color-mix(in srgb, var(--accent-color) 5%, transparent) !important;
    }
}

/* ============================================ */
/* === КОНЕЦ ФАЙЛА CSS === */
/* ============================================ */

/* ============================================ */
/* НОВЫЙ ДВУХКОЛОНОЧНЫЙ РЕЖИМ ДЛЯ БЛОКОВ      */
/* ============================================ */

/* ОСНОВНОЙ двухколоночный режим - используем CSS Grid */
#song-content.split-columns pre {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px; /* Увеличиваем расстояние между колонками */
    column-count: unset; /* Отключаем старый column-count */
    position: relative;
    align-items: start; /* Выравниваем колонки по верху */
    overflow: hidden; /* Запрещаем выход за пределы контейнера */
}

/* Убираем старую центральную линию */
#song-content.split-columns pre::before {
    display: none;
}

/* Стили для колонок */
#song-content.split-columns .column-1,
#song-content.split-columns .column-2 {
    display: flex;
    flex-direction: column;
    gap: 8px; /* Отступы между блоками внутри колонки */
    width: 100%;
    max-width: 100%; /* Строго ограничиваем ширину */
    box-sizing: border-box;
    overflow: hidden; /* Запрещаем выход за пределы */
}

/* Каждый блок занимает всю ширину своей колонки и не выходит за границы */
#song-content.split-columns .song-block {
    break-inside: avoid; /* Запрещаем разрыв блока */
    page-break-inside: avoid; /* Для старых браузеров */
    display: block;
    width: 100%;
    max-width: 100%; /* Строго ограничиваем ширину */
    box-sizing: border-box;
    overflow: hidden; /* Запрещаем выход за пределы */
    margin-bottom: 0; /* Убираем стандартные отступы - используем gap */
}

/* Содержимое блока должно переносится */
#song-content.split-columns .song-block-content {
    word-wrap: break-word !important; /* Принудительный перенос длинных слов */
    word-break: break-word !important; /* Разрываем слова если нужно */
    overflow-wrap: break-word !important; /* Современный стандарт */
    white-space: pre-wrap !important; /* Сохраняем пробелы но разрешаем перенос */
    max-width: 100% !important; /* Строго ограничиваем ширину */
    overflow: hidden !important; /* Запрещаем выход за пределы */
}

/* Блоки без fieldset (текст до первого маркера) тоже не разрываем */
#song-content.split-columns pre > *:not(.song-block):not(.column-1):not(.column-2) {
    break-inside: avoid;
    page-break-inside: avoid;
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: pre-wrap !important;
    max-width: 100% !important;
    overflow: hidden !important;
}

/* ============================================ */
/* SPLIT MODE ДЛЯ ПРЕЗЕНТАЦИИ                 */
/* ============================================ */

/* Двухколоночный режим для презентации */
#presentation-content.split-columns .presentation-song pre {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px; /* Чуть больше для презентации */
    column-count: unset;
    position: relative;
    align-items: start;
    overflow: hidden;
}

#presentation-content.split-columns .presentation-song pre::before {
    display: none;
}

#presentation-content.split-columns .column-1,
#presentation-content.split-columns .column-2 {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Отступы между блоками в презентации */
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

#presentation-content.split-columns .song-block {
    break-inside: avoid;
    page-break-inside: avoid;
    display: block;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
    margin-bottom: 0;
}

#presentation-content.split-columns .song-block-content {
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: pre-wrap !important;
    max-width: 100% !important;
    overflow: hidden !important;
}

#presentation-content.split-columns .presentation-song pre > *:not(.song-block):not(.column-1):not(.column-2) {
    break-inside: avoid;
    page-break-inside: avoid;
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: pre-wrap !important;
    max-width: 100% !important;
    overflow: hidden !important;
}



/* ============================================ */
/* SONG EDITOR                                */
/* ============================================ */

@media (max-width: 768px) {
    .song-controls {
        justify-content: center;
        gap: 8px;
        margin: 8px 0 10px 0;
    }

    .song-editor-modal {
        width: 95%;
        height: 90%;
        margin: 5% auto;
        max-width: none;
    }

    .song-editor-header {
        padding: 10px;
    }

    .song-editor-header h3 {
        font-size: 1rem;
    }

    .song-editor-content {
        padding: 10px;
    }

    .song-edit-textarea {
        font-size: 0.85rem;
    }

    .song-editor-footer {
        padding: 10px;
    }

    .editor-controls {
        gap: 8px;
        justify-content: center;
    }

    .editor-button {
        padding: 8px 12px;
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .song-editor-modal {
        width: 98%;
        height: 95%;
        margin: 2.5% auto;
        border-radius: 6px;
    }

    .song-editor-header {
        padding: 8px;
    }

    .song-editor-header h3 {
        font-size: 0.9rem;
    }

    .song-editor-content {
        padding: 8px;
    }

    .editor-info {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
    }

    .song-edit-textarea {
        font-size: 0.8rem;
        line-height: 1.3;
    }

    .song-editor-footer {
        padding: 8px;
    }

    .editor-controls {
        gap: 6px;
    }

    .editor-button {
        padding: 6px 10px;
        font-size: 0.75rem;
    }
}



/* АДАПТИВНОСТЬ для мобильных */
@media (max-width: 480px) {
    #song-content.split-columns pre {
        gap: 8px; /* Меньше на мобильных */
    }
    
    #song-content.split-columns .column-1,
    #song-content.split-columns .column-2 {
        gap: 6px; /* Меньше отступы между блоками на мобильных */
    }
    
    #presentation-content.split-columns .presentation-song pre {
        gap: 10px;
    }
    
    #presentation-content.split-columns .column-1,
    #presentation-content.split-columns .column-2 {
        gap: 8px;
    }
}

/* ============================================ */
/* КНОПКИ ДЕЙСТВИЙ С LEGEND-ГРАНИЦАМИ         */
/* ============================================ */

/* Song Actions Legend Row (компактные кнопки с границами как fieldset) */
.song-actions-legend-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px; /* Уменьшили с 25px */
    margin: 12px 0 16px 0; /* Уменьшили отступы */
}

.song-legend-action {
    position: relative;
    display: inline-block;
}

/* Сама кнопка - компактная */
.legend-icon-btn {
    width: 60px; /* Уменьшили с 80px */
    height: 40px; /* Уменьшили с 50px */
    border: 1.5px solid var(--border-color);
    background: transparent;
    color: var(--text-color);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px; /* Уменьшили с 8px */
    font-size: 1.1rem; /* Уменьшили с 1.3rem */
    transition: all 0.2s ease;
    cursor: pointer;
    box-shadow: none;
    padding: 0;
    margin: 0;
    margin-top: 8px; /* Уменьшили с 12px */
}

/* Legend как часть границы - фон контейнера для закрытия границы */
.song-legend-action::before {
    content: attr(data-legend);
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background: var(--container-background-color); /* Фон как у основного контейнера */
    color: var(--label-color);
    font-size: 0.45rem; /* Еще больше уменьшили с 0.55rem */
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.2px; /* Уменьшили с 0.3px */
    padding: 1px 6px; /* Увеличили боковые отступы для лучшего закрытия границы */
    white-space: nowrap;
    z-index: 1;
    transition: color 0.2s ease;
    max-width: 50px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.legend-icon-btn:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    background: var(--hover-color);
    transform: translateY(-1px); /* Уменьшили с -2px */
    box-shadow: 0 2px 8px var(--shadow-color); /* Уменьшили с 0 4px 12px */
}

.legend-icon-btn:hover + .song-legend-action::before,
.song-legend-action:hover::before {
    color: var(--primary-color);
}

.legend-icon-btn:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color) 20%, transparent);
}

.legend-icon-btn:active {
    transform: translateY(0);
    background: var(--primary-color);
    color: white;
}

.legend-icon-btn i {
    pointer-events: none;
}

/* Цветовые состояния для активных кнопок */
.legend-icon-btn.heart.active {
    color: #e74c3c;
    border-color: #e74c3c;
    background: color-mix(in srgb, #e74c3c 10%, transparent);
}

.legend-icon-btn.setlist.active {
    color: #27ae60;
    border-color: #27ae60;
    background: color-mix(in srgb, #27ae60 10%, transparent);
}

.legend-icon-btn.mic.active {
    color: #7c4dff;
    border-color: #7c4dff;
    background: color-mix(in srgb, #7c4dff 10%, transparent);
}

/* Активные состояния для legend */
.song-legend-action.heart.active::before {
    color: #e74c3c;
}

.song-legend-action.setlist.active::before {
    color: #27ae60;
}

.song-legend-action.mic.active::before {
    color: #7c4dff;
}

@media (max-width: 768px) {
    .song-actions-legend-row {
        gap: 15px;
        margin: 10px 0 14px 0;
    }
    
    .legend-icon-btn {
        width: 55px;
        height: 36px;
        font-size: 1rem;
        margin-top: 7px;
    }
    
    .song-legend-action::before {
        font-size: 0.5rem;
        padding: 1px 3px;
        max-width: 45px;
    }
}

@media (max-width: 480px) {
    .song-actions-legend-row {
        gap: 12px;
        margin: 8px 0 12px 0;
    }
    
    .legend-icon-btn {
        width: 50px;
        height: 32px;
        font-size: 0.9rem;
        margin-top: 6px;
    }
    
    .song-legend-action::before {
        font-size: 0.45rem;
        padding: 1px 2px;
        max-width: 40px;
    }
}
