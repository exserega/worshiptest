# Agape Worship — локальная разработка и PWA‑памятка

## Локальный запуск (Windows PowerShell)
- Перейти в папку проекта:
  - `cd "C:\Users\BM DESIGN\Desktop\Worship site\worshiptest-main"`
- Запустить сервер:
  - `py -m http.server 8001`
- Открыть в браузере:
  - Главная: `http://localhost:8001/`
  - Логин: `http://localhost:8001/public/login.html`
  - Настройки: `http://localhost:8001/public/settings.html`
  - Админ: `http://localhost:8001/public/admin.html`

Примечание: в PowerShell не используйте `&&`. Команды выполнять по очереди.

## Firebase инициализация (единая)
- На всех страницах в `public/` подключается только общий `firebase-init.js` (без дублирующих конфигов).
- Порядок: сначала CDN SDK v8 (если нужно), затем `firebase-init.js`, затем ваши модули.

## Service Worker (PWA)
- Текущая версия: v346.
- При изменении путей/критичных ресурсов — увеличьте `CACHE_NAME` в `sw.js` (например, `v347`).
- После обновления: в браузере DevTools → Application → Clear storage → Clear site data → перезагрузить страницу.

## Важно: работа с инструментами
- При возникновении ошибок инструментов (Tool call failed) — сразу прерывайте работу и начинайте заново.
- Всегда проверяйте соединение командой `echo "Test"` перед продолжением.
- Если инструменты не работают несколько раз подряд — подождите и попробуйте снова.

## Мобильное приложение (TWA)
- Изменения сайта (HTML/CSS/JS) после деплоя на `agapeworship.asia` попадают в приложение автоматически.
- APK/AAB пересобирать НЕ нужно для контент‑изменений. Обязательно повышайте версию кэша в `sw.js`.
- Адресная строка в TWA исчезает при корректном `/.well-known/assetlinks.json` (см. `documentation/MOBILE_RELEASE_GUIDE.md`).

## Офлайн режим
- Включена офлайн‑персистентность Firestore; ранее загруженные песни/списки/репертуар доступны офлайн.
- При отсутствии сети чтение идёт из кэша; изменения (запись) выполняются только онлайн.

## Мобильная адаптация
- Используйте CSS псевдо-селектор `:has()` для условной логики стилей
- Для исправления двойной прокрутки на мобильных:
  ```css
  @media (max-width: 768px) {
      body:has(.specific-class) {
          overflow: auto;
      }
      body:has(.specific-class) .container {
          height: auto;
          overflow: visible;
      }
  }
  ```

## UI компоненты и стиль
- Основной цвет акцента: `#00b2bc` (бирюзовый)
- Используйте полупрозрачные фоны: `rgba(255, 255, 255, 0.05)`
- Эффект размытия фона: `backdrop-filter: blur(20px)`
- Радиусы скругления: 8px для кнопок, 12px для модальных окон
- Переходы: `transition: all 0.2s ease`
- **ВАЖНО**: См. `documentation/STYLE_GUIDE.md` для полного руководства по стилям и дизайну

## Диагностика
- Если видите `Firebase: No Firebase App '[DEFAULT]'` — проверьте, что `firebase-init.js` загружается раньше модулей страницы.
- Сообщения вида `Unchecked runtime.lastError: The message port closed...` приходят от расширений браузера и не относятся к сайту.

## Логи
- Для логов используйте `src/utils/logger.js`. На localhost логи видны, в продакшене — скрыты.

## Календарь событий
- Страница: `/public/events/` 
- Компоненты:
  - `events-calendar.js` — основная логика календаря и отображения событий
  - `eventCreationModal.js` — модальное окно создания/редактирования событий
  - `eventsApi.js` — взаимодействие с Firebase для событий
- Режимы отображения: сетка календаря и список событий
- Поддерживает создание, редактирование, удаление событий
- Участники событий могут быть как зарегистрированными пользователями, так и введенными вручную
- **Новые возможности (январь 2025)**:
  - Улучшенный дизайн карточек в режиме списка
  - Интерактивный разворачивающийся список участников
  - Создатель события не добавляется автоматически в участники
  - Корректная передача даты из календаря в модальное окно

## Работа с иконками и темами
- Вместо Font Awesome используются inline SVG для лучшей производительности
- Для поддержки светлой и темной темы используйте:
  ```css
  /* Темная тема (по умолчанию) */
  .icon-button {
      color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.1);
  }
  
  /* Светлая тема */
  [data-theme="light"] .icon-button {
      color: rgba(0, 0, 0, 0.6);
      background: rgba(0, 0, 0, 0.1);
  }
  ```
- SVG иконки наследуют цвет через `currentColor` в path/stroke

## Коммиты и деплой
- Используйте осмысленные сообщения коммитов:
  - `feat:` — новая функциональность
  - `fix:` — исправление ошибок
  - `refactor:` — изменение кода без изменения функциональности
  - `style:` — изменения стилей/форматирования
- После внесения изменений:
  1. `git add -A` — добавить все изменения
  2. `git commit -m "тип: описание"` — создать коммит
  3. `git push` — отправить на GitHub
  4. GitHub Pages автоматически обновится через 1-2 минуты

## Документация
- `/documentation/AI_AGENT_CRITICAL_GUIDE.md` — критически важная информация для AI агентов
- `/documentation/AI_AGENT_GUIDE.md` — детальное руководство по проекту
- `/documentation/STYLE_GUIDE.md` — руководство по стилям и дизайну
- `/documentation/EVENTS_FEATURE_GUIDE.md` — руководство по функционалу событий
- `/documentation/ROLES_AND_PERMISSIONS_GUIDE.md` — система ролей и прав доступа
