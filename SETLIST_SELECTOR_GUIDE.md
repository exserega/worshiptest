# üìã –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–µ—Ç-–ª–∏—Å—Ç—ã

## üéØ –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Å–µ–Ω –≤ —Å–µ—Ç-–ª–∏—Å—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–µ—Å–Ω–∏ –≤ –ª—é–±–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ.

## üìç –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. **–ö–Ω–æ–ø–∫–∞ "–°–ï–¢ –õ–ò–°–¢" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ**
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Å–Ω–∏, —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ú–û–ò" –∏ "–†–ï–ü–ï–†–¢–£–ê–†"
- **–§—É–Ω–∫—Ü–∏—è**: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç overlay –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–µ—Ç-–ª–∏—Å—Ç–∞
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫**: `window.handleAddSongToSetlist()`

### 2. **Overlay –≤—ã–±–æ—Ä–∞ —Å–µ—Ç-–ª–∏—Å—Ç–∞ (setlist-select-overlay)**
- **–ú–æ–¥—É–ª—å**: `src/ui/setlist-selector.js`
- **–°—Ç–∏–ª–∏**: `styles/modals.css` (–∫–ª–∞—Å—Å `.setlist-select-modal`)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª–∞—Å—Å `visible` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ `show`!)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è
```javascript
// src/ui/setlist-selector.js
class SetlistSelector {
    constructor() {
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        this.overlay = document.getElementById('setlist-select-overlay');
        this.songNameDisplay = document.getElementById('adding-song-name');
        this.songKeyDisplay = document.getElementById('adding-song-key');
        this.setlistsGrid = document.getElementById('setlists-grid');
        // ...
    }
    
    open(song, key) // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–µ—Å–Ω–∏
    close()         // –ó–∞–∫—Ä—ã—Ç–∏–µ overlay
    loadSetlists()  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Ç-–ª–∏—Å—Ç–æ–≤
    selectSetlist() // –í—ã–±–æ—Ä —Å–µ—Ç-–ª–∏—Å—Ç–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
    addToSetlist()  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Å–Ω–∏ –≤ —Å–µ—Ç-–ª–∏—Å—Ç
    handleCreateNew() // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ç-–ª–∏—Å—Ç–∞
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π
```javascript
// script.js
window.handleAddSongToSetlist = async function() {
    const songId = ui.songSelect?.value;
    const selectedKey = ui.keySelect?.value;
    const currentSong = window.state?.allSongs?.find(s => s.id === songId);
    
    if (currentSong) {
        window.openSetlistSelector(currentSong, selectedKey);
    }
};

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
window.openSetlistSelector = (song, key) => selector.open(song, key);
```

## üé® UI/UX –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω
- **–ó–∞–≥–æ–ª–æ–≤–æ–∫**: "–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç-–ª–∏—Å—Ç" —Å –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Å–Ω–µ**: –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–°–ø–∏—Å–æ–∫ —Å–µ—Ç-–ª–∏—Å—Ç–æ–≤**: Grid layout —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Å–µ–Ω
- **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ**: –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–æ–ª–µ –≤–Ω–∏–∑—É

### –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
```css
/* –í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–µ—Ç-–ª–∏—Å—Ç */
.setlist-item.selected {
    background: var(--hover-color);
    border-color: var(--accent-color);
}

/* –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Å–Ω–∏ */
.song-key #adding-song-key {
    padding: 0.2rem 0.6rem;
    background: var(--hover-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    text-transform: none !important;
}
```

## üîÑ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ú–µ—Ö–∞–Ω–∏–∑–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Å–Ω–∏** ‚Üí API –≤—ã–∑–æ–≤ `addSongToSetlist(setlistId, songId, key)`
2. **–õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Üí –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç
3. **–°–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** ‚Üí Dispatch `setlist-updated` event
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI** ‚Üí `handleSetlistSelect()` –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
```javascript
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ù–ï–ó–ê–í–ò–°–ò–ú–û –æ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–∞–Ω–µ–ª–∏
if (window.state?.currentSetlistId === setlistId) {
    setTimeout(async () => {
        const setlists = await loadSetlists();
        const updatedSetlist = setlists.find(s => s.id === setlistId);
        if (updatedSetlist && window.handleSetlistSelect) {
            window.handleSetlistSelect(updatedSetlist);
        }
    }, 300);
}
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. **–ö–ª–∞—Å—Å visible vs show**
```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
this.overlay?.classList.add('show');

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
this.overlay?.classList.add('visible');
```

### 2. **–§–æ—Ä–º–∞—Ç –≤—ã–∑–æ–≤–∞ API**
```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø–µ—Ä–µ–¥–∞—á–∞ –æ–±—ä–µ–∫—Ç–∞
await addSongToSetlist(setlistId, songObject);

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ç—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
await addSongToSetlist(setlistId, songId, selectedKey);
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–≤—ã–±–æ—Ä–∞**
- –°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–≤—ã–±–∏—Ä–∞—Ç—å —Å–µ—Ç-–ª–∏—Å—Ç
- –ó–∞–¥–µ—Ä–∂–∫–∞ 300–º—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Firebase

### 4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**
- –ü–µ—Å–Ω—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ overlay
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `key` –≤ Firebase

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç**
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ç-–ª–∏—Å—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Å–Ω–∏
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å—á–µ—Ç—á–∏–∫–µ

2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–∏–π —Å–µ—Ç-–ª–∏—Å—Ç**
   - –í—ã–±—Ä–∞—Ç—å —Å–µ—Ç-–ª–∏—Å—Ç –≤ –ø–∞–Ω–µ–ª–∏
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**
   - –í—ã–±—Ä–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ overlay
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ Firebase

## üìù –û—Ç–ª–∞–¥–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –ª–æ–≥–∏
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
üìã [SetlistSelector] Opening with key: G
üìã [SetlistSelector] Adding song: ... to setlist: ... in key: G
üìã [SetlistSelector] Current setlist was updated, refreshing display
üìã [EventHandlers] Updating songs for current setlist: ...
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **Overlay –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è** ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –≤ `initialization.js`
2. **–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –≤–∏–¥–Ω–∞** ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSS –∏ —ç–ª–µ–º–µ–Ω—Ç `#adding-song-key`
3. **–°–ø–∏—Å–æ–∫ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `currentSetlistId` –≤ state

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 21.01.2025
**–í–µ—Ä—Å–∏—è:** 1.0