<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø–∞</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .status {
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            background: #333;
        }
        .success { background: #4caf50; }
        .error { background: #f44336; }
        .info { background: #2196f3; }
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üîê –¢–µ—Å—Ç –∞–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø–∞</h1>
    
    <div id="firebase-status" class="status">–ü—Ä–æ–≤–µ—Ä–∫–∞ Firebase...</div>
    <div id="auth-status" class="status">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...</div>
    <div id="user-info" class="status">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</div>
    <div id="admin-status" class="status">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...</div>
    
    <div style="margin-top: 20px;">
        <button onclick="testAdminAccess()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø</button>
        <button onclick="window.location.href='/admin.html'">–û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
        <button onclick="window.location.href='/'">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
    </div>
    
    <div id="log" style="margin-top: 20px; background: #222; padding: 20px; border-radius: 5px;">
        <h3>–õ–æ–≥–∏:</h3>
        <pre id="log-content"></pre>
    </div>

    <script>
        const log = (message) => {
            console.log(message);
            const logContent = document.getElementById('log-content');
            logContent.textContent += message + '\n';
        };

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBzDxg3S9cfseoozmZSksUh1aLbkVBG--Q",
            authDomain: "song-archive-389a6.firebaseapp.com",
            projectId: "song-archive-389a6",
            storageBucket: "song-archive-389a6.appspot.com",
            messagingSenderId: "660585697058",
            appId: "1:660585697058:web:7ceacf752ce6b21ad8fb40"
        };

        // Initialize Firebase
        log('üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.firebase = firebase;
        window.auth = auth;
        window.db = db;
        
        document.getElementById('firebase-status').className = 'status success';
        document.getElementById('firebase-status').textContent = '‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω';
        log('‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º persistence
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
            .then(() => {
                log('‚úÖ Persistence —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ LOCAL');
            })
            .catch((error) => {
                log('‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ persistence: ' + error.message);
            });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        auth.onAuthStateChanged(async (user) => {
            const authStatus = document.getElementById('auth-status');
            const userInfo = document.getElementById('user-info');
            const adminStatus = document.getElementById('admin-status');
            
            if (user) {
                log('üîê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω: ' + user.uid);
                authStatus.className = 'status success';
                authStatus.textContent = '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                userInfo.innerHTML = `
                    <strong>UID:</strong> ${user.uid}<br>
                    <strong>Email:</strong> ${user.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                    <strong>Phone:</strong> ${user.phoneNumber || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                `;
                userInfo.className = 'status info';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Firestore
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        log('üìÑ –î–∞–Ω–Ω—ã–µ –∏–∑ Firestore: ' + JSON.stringify(userData));
                        
                        userInfo.innerHTML += `<br><br><strong>Firestore –¥–∞–Ω–Ω—ã–µ:</strong><br>
                            –†–æ–ª—å: ${userData.role}<br>
                            –°—Ç–∞—Ç—É—Å: ${userData.status}<br>
                            –§–∏–ª–∏–∞–ª: ${userData.branchId || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}`;
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
                        const MAIN_ADMIN_ID = 'm4L5O5rs2phMHtfcVuWnCAkXJBD2';
                        const MAIN_ADMIN_EMAIL = '19exxtazzy96@gmail.com';
                        
                        if (user.uid === MAIN_ADMIN_ID || user.email === MAIN_ADMIN_EMAIL || userData.role === 'admin') {
                            adminStatus.className = 'status success';
                            adminStatus.textContent = '‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã';
                            log('‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω');
                        } else {
                            adminStatus.className = 'status error';
                            adminStatus.textContent = '‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
                            log('‚ùå –ù–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
                        }
                    } else {
                        log('‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Firestore');
                        userInfo.innerHTML += '<br><br>‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Firestore';
                    }
                } catch (error) {
                    log('‚ùå –û—à–∏–±–∫–∞ Firestore: ' + error.message);
                }
            } else {
                log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                authStatus.className = 'status error';
                authStatus.textContent = '‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                userInfo.textContent = '';
                adminStatus.textContent = '';
            }
        });
        
        function testAdminAccess() {
            const user = auth.currentUser;
            if (user) {
                log('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è: ' + user.uid);
                alert('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ' + user.email + '\nUID: ' + user.uid);
            } else {
                log('‚ùå –ù–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!');
            }
        }
    </script>
</body>
</html>